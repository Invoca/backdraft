<!DOCTYPE html>

<html>
<head>
  <title>backdraft.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>backdraft.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$</span>) </span>{

  <span class="hljs-keyword">var</span> Backdraft = {};
  Backdraft.Utils = {};

  Backdraft.Utils.Class = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Backbone.js class implementation
Helper function to correctly set up the prototype chain, for subclasses.
Similar to <code>goog.inherits</code>, but uses a hash of prototype properties and
class properties to be extended.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> extend = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">protoProps, staticProps</span>) </span>{
    <span class="hljs-keyword">var</span> parent = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">var</span> child;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>The constructor function for the new subclass is either defined by you
(the “constructor” property in your <code>extend</code> definition), or defaulted
by us to simply call the parent’s constructor.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (protoProps &amp;&amp; _.has(protoProps, <span class="hljs-string">'constructor'</span>)) {
      child = protoProps.constructor;
    } <span class="hljs-keyword">else</span> {
      child = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{ <span class="hljs-keyword">return</span> parent.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>); };
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Add static properties to the constructor function, if supplied.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _.extend(child, parent, staticProps);</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Set the prototype chain to inherit from <code>parent</code>, without calling
<code>parent</code>‘s constructor function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> Surrogate = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{ <span class="hljs-keyword">this</span>.constructor = child; };
    Surrogate.prototype = parent.prototype;
    child.prototype = <span class="hljs-keyword">new</span> Surrogate;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Add prototype properties (instance properties) to the subclass,
if supplied.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (protoProps) _.extend(child.prototype, protoProps);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Set a convenience property in case the parent’s prototype is needed
later.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    child.__super__ = parent.prototype;

    <span class="hljs-keyword">return</span> child;
  };

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Class</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.initialize &amp;&amp; <span class="hljs-keyword">this</span>.initialize.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
  }

  Class.prototype._getterSetter = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">prop</span>) </span>{
    <span class="hljs-keyword">this</span>._store || (<span class="hljs-keyword">this</span>._store = {});

    <span class="hljs-keyword">this</span>[prop] = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) </span>{
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">this</span>._store[prop] = value;
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._store[prop];
      }
    };
  }

  _.extend(Class, {
    extend : extend
  });

  <span class="hljs-keyword">return</span> Class;

})();</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>create a valid CSS class name based on input</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Backdraft.Utils.toCSSClass = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> cssClass = <span class="hljs-regexp">/[^a-zA-Z_0-9\-]/g</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">input</span>) </span>{
    <span class="hljs-keyword">return</span> input.replace(cssClass, <span class="hljs-string">"-"</span>);
  };
})();

  <span class="hljs-keyword">var</span> App = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

  <span class="hljs-keyword">var</span> getInstance = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) </span>{
    <span class="hljs-keyword">if</span> (App.instances[name]) <span class="hljs-keyword">return</span> App.instances[name];
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"App "</span> + name + <span class="hljs-string">" does not exist"</span>);
  };

  <span class="hljs-keyword">var</span> App = Backdraft.Utils.Class.extend({

    constructor : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>list of plugins by name this app should load, defaulting to none.
apps should either override this property or append to it in their #initialize method</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.plugins) <span class="hljs-keyword">this</span>.plugins = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>ensure that the Base plugin as always loaded</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (!_.include(<span class="hljs-keyword">this</span>.plugins, <span class="hljs-string">"Base"</span>)) <span class="hljs-keyword">this</span>.plugins.unshift(<span class="hljs-string">"Base"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>call parent constructor</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      App.__super__.constructor.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>load plugins for this application</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Plugin.load(<span class="hljs-keyword">this</span>.plugins, <span class="hljs-keyword">this</span>);
    },

    activate : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"#activate must be implemented in your class"</span>);
    },

    destroy : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>to be implemented in subclasses</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    }

  }, {

    instances : {

    },

    factory : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, obj</span>) </span>{
      <span class="hljs-keyword">if</span> (!obj) {
        <span class="hljs-keyword">return</span> getInstance(name);
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (_.isFunction(obj)) {
        obj(getInstance(name));
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (_.isObject(obj)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>define app and create an instance of it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (App.instances[name]) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"App "</span> + name + <span class="hljs-string">" is already defined"</span>);
        <span class="hljs-keyword">var</span> appClass = App.extend(_.extend(obj, { name : name }));
        App.instances[name] = <span class="hljs-keyword">new</span> appClass();
        <span class="hljs-keyword">return</span> App.instances[name];
      }

    }

  });</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>add pub/sub support to the app</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _.extend(App.prototype, Backbone.Events);</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>support for destroying apps</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _.extend(App.factory, {</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>destroys all existing applications</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    destroyAll : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      _.chain(App.instances).keys().each(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) </span>{ 
        App.factory.destroy(name);
      });
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>destroy a single application with provided name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    destroy : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) </span>{
      getInstance(name).destroy();
      <span class="hljs-keyword">delete</span> App.instances[name];
    }

  });



  <span class="hljs-keyword">return</span> App;

})();
  Backdraft.app = App.factory;

  <span class="hljs-keyword">var</span> Plugin = Backdraft.Utils.Class.extend({

  initialize : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) </span>{
    <span class="hljs-keyword">this</span>.name = name;
    <span class="hljs-keyword">this</span>.initializers = [];
    <span class="hljs-keyword">this</span>.exportedData = {};
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>store a list of callback functions that will be executed in order
and passed an instance of a Backdraft application. Plugins are then able to add
factories and other properties onto an application instance</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  initializer : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fn</span>) </span>{
    <span class="hljs-keyword">this</span>.initializers.push(fn);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>allow plugins to export static helpers, constants, etc</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  exports : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
    _.extend(<span class="hljs-keyword">this</span>.exportedData, data);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>call all initializers, providing Backdraft app instance to each</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  runInitializers : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">app</span>) </span>{
    _.each(<span class="hljs-keyword">this</span>.initializers, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fn</span>) </span>{
      fn(app);
    });
  }

}, {

  registered : {

  },

  factory : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, fn</span>) </span>{
    <span class="hljs-keyword">if</span> (!fn) {</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>return exports of plugin with provided name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (!Plugin.registered[name]) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Plugin "</span> + name + <span class="hljs-string">" has not been registered"</span>);
      <span class="hljs-keyword">return</span> Plugin.registered[name].exportedData;
    } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>create and register new plugin. afterwards invoke callback with it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (Plugin.registered[name]) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Plugin "</span> + name + <span class="hljs-string">" is already registered"</span>);
      Plugin.registered[name] = <span class="hljs-keyword">new</span> Plugin(name);
      fn(Plugin.registered[name]);
    }
  },

  load : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">pluginNames, app</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>load plugins the app has specified</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _.each(pluginNames, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) </span>{
      <span class="hljs-keyword">if</span> (!Plugin.registered[name]) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Plugin "</span> + name + <span class="hljs-string">" has not been registered"</span>);
      Plugin.registered[name].runInitializers(app);
    });
  }

});

_.extend(Plugin.factory, {

  destroyAll : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    _.each(Plugin.registered, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">plugin, name</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>the Base plugin cannot be destroyed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (name !== <span class="hljs-string">"Base"</span>) <span class="hljs-keyword">delete</span> Plugin.registered[name];
    })
  }
});

  Backdraft.plugin = Plugin.factory;

  Backdraft.plugin(<span class="hljs-string">"Base"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">plugin</span>) </span>{

  <span class="hljs-keyword">var</span> View = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

  <span class="hljs-keyword">var</span> View = Backbone.View.extend({

    constructor : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>.children = {};
      View.__super__.constructor.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
    },

    child : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, view</span>) </span>{
      <span class="hljs-keyword">var</span> existing = <span class="hljs-keyword">this</span>.children[name];
      <span class="hljs-keyword">if</span> (!view) <span class="hljs-keyword">return</span> existing;
      <span class="hljs-keyword">if</span> (existing) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"View "</span> + name + <span class="hljs-string">" already exists"</span>);
      <span class="hljs-keyword">this</span>.children[name] = _.extend(view, { 
        parent : <span class="hljs-keyword">this</span>,
        name : name
      });
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.children[name];
    },

    close : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"beforeClose"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>close children</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      _.each(<span class="hljs-keyword">this</span>.children, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">child</span>) </span>{
        child.close();
      });</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>detach from parent</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.parent) {
        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.parent.children[<span class="hljs-keyword">this</span>.name];
        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.parent;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>remove from the DOM</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.remove();
      <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"afterClose"</span>);
      <span class="hljs-keyword">this</span>.off();
    }

  });

  <span class="hljs-keyword">return</span> View;

})();

  <span class="hljs-keyword">var</span> Collection = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

  <span class="hljs-keyword">var</span> Collection = Backbone.Collection.extend({

  });

  <span class="hljs-keyword">return</span> Collection;

})();
  <span class="hljs-keyword">var</span> Model = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

  <span class="hljs-keyword">var</span> Model = Backbone.Model.extend({</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>notify change listeners, but with current values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    reTriggerChanges : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> attr <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>.attributes) {
        <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"change:"</span> + attr, <span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>.get(attr), {});
      }
      <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"change"</span>, <span class="hljs-keyword">this</span>, {});
    }

  });

  <span class="hljs-keyword">return</span> Model;

})();
  <span class="hljs-keyword">var</span> Router = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

  <span class="hljs-keyword">var</span> splatParam = <span class="hljs-regexp">/\*\w+/g</span>;
  <span class="hljs-keyword">var</span> optionalParam = <span class="hljs-regexp">/\((.*?)\)/g</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>helper method for creating Rails style named routes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createNameHelper</span>(<span class="hljs-params">name, route</span>) </span>{
    <span class="hljs-keyword">var</span> helper = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">params, splat</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>replace splat</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> genRoute = route.replace(splatParam, splat || <span class="hljs-string">""</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>replace required params</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      _.each(params, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">v, k</span>) </span>{
        genRoute = genRoute.replace(<span class="hljs-string">":"</span> + k, v);
      });
      _.each(genRoute.match(optionalParam), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">p</span>) </span>{
        <span class="hljs-keyword">if</span> (_.include(p, <span class="hljs-string">":"</span>)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>optional param unfulfilled, remove it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          genRoute = genRoute.replace(p, <span class="hljs-string">""</span>);
        } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>optional param fulfilled, remove just the parens</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          genRoute = genRoute.replace(p, p.slice(<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>));
        }
      });
      <span class="hljs-keyword">if</span> (_.include(genRoute, <span class="hljs-string">":"</span>)) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Route for "</span> + name + <span class="hljs-string">" can't be created"</span>);
      <span class="hljs-keyword">return</span> genRoute;
    };

    <span class="hljs-keyword">this</span>.nameHelper[name] = helper;
  };

  <span class="hljs-keyword">var</span> Router = Backbone.Router.extend({

    constructor : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>) </span>{
      options || (options = {});
      <span class="hljs-keyword">if</span> (!options.$el || options.$el.length !== <span class="hljs-number">1</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"$el can't be found"</span>);
      <span class="hljs-keyword">this</span>.$el = options.$el;
      <span class="hljs-keyword">this</span>.nameHelper = {};
      Router.__super__.constructor.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
    },

    route : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">route, name, callback</span>) </span>{
      <span class="hljs-keyword">var</span> nameHelperMethod;
      <span class="hljs-keyword">if</span> (!_.isFunction(name)) {
        <span class="hljs-keyword">if</span> (!_.isArray(name)) {
          nameHelperMethod = name
        } <span class="hljs-keyword">else</span> {
          nameHelperMethod = name[<span class="hljs-number">1</span>];
          name = name[<span class="hljs-number">0</span>];
        }
        createNameHelper.call(<span class="hljs-keyword">this</span>, nameHelperMethod, route);
      }
      <span class="hljs-keyword">return</span> Router.__super__.route.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
    },

    swap : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">nextView</span>) </span>{
      <span class="hljs-keyword">this</span>.activeView &amp;&amp; <span class="hljs-keyword">this</span>.activeView.close();
      <span class="hljs-keyword">this</span>.activeView = nextView;
      <span class="hljs-keyword">this</span>.activeView.trigger(<span class="hljs-string">"beforeSwap"</span>, <span class="hljs-keyword">this</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>render new view and place into router’s element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.activeView.render();
      <span class="hljs-keyword">this</span>.$el.html(<span class="hljs-keyword">this</span>.activeView.$el);
      <span class="hljs-keyword">this</span>.activeView.trigger(<span class="hljs-string">"afterSwap"</span>, <span class="hljs-keyword">this</span>);
    }

  });

  <span class="hljs-keyword">return</span> Router;

})();
  <span class="hljs-keyword">var</span> Cache = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getKey</span>(<span class="hljs-params">key</span>) </span>{
    <span class="hljs-keyword">if</span> (key.cid) <span class="hljs-keyword">return</span> key.cid;
    <span class="hljs-keyword">if</span> (_.isString(key)) <span class="hljs-keyword">return</span> key;
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Invalid key type"</span>);
  }

  <span class="hljs-keyword">var</span> Cache = Backdraft.Utils.Class.extend({

    initialize : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>.reset();
    },

    set : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key, value</span>) </span>{
      <span class="hljs-keyword">this</span>.data[getKey(key)] = value;
      <span class="hljs-keyword">return</span> value;
    },

    unset : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key</span>) </span>{
      key = getKey(key);
      <span class="hljs-keyword">var</span> value = <span class="hljs-keyword">this</span>.data[key];
      <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.data[key];
      <span class="hljs-keyword">return</span> value;
    },

    get : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key</span>) </span>{
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.data[getKey(key)];
    },

    size : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> _.keys(<span class="hljs-keyword">this</span>.data).length;
    },

    reset : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>.data = {};
    },

    each : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">iterator, context</span>) </span>{
      _.each(<span class="hljs-keyword">this</span>.data, iterator, context);
    }

  });

  <span class="hljs-keyword">return</span> Cache;


})();

  plugin.exports({
    Router : Router,
    View : View,
    Model : Model,
    Collection : Collection,
    Cache : Cache
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>factories</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  plugin.initializer(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">app</span>) </span>{
    app.Views = {};
    app.view = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, baseClassName, properties</span>) </span>{
      <span class="hljs-keyword">var</span> baseClass;
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">2</span>) {
        properties = baseClassName;
        baseClass = View;
      } <span class="hljs-keyword">else</span> {
        baseClass = app.Views[baseClassName];
      }

      app.Views[name] = baseClass.extend(properties);
    };

    app.Collections = {}
    app.collection = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, baseClassName, properties</span>) </span>{
      <span class="hljs-keyword">var</span> baseClass;
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">2</span>) {
        properties = baseClassName;
        baseClass = Collection;
      } <span class="hljs-keyword">else</span> {
        baseClass = app.Collections[baseClassName];
      }

      app.Collections[name] = baseClass.extend(properties);
    };

    app.Models = {};
    app.model = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, baseClassName, properties</span>) </span>{
      <span class="hljs-keyword">var</span> baseClass;
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">2</span>) {
        properties = baseClassName;
        baseClass = Model;
      } <span class="hljs-keyword">else</span> {
        baseClass = app.Models[baseClassName];
      }

      app.Models[name] = baseClass.extend(properties);
    };

    app.Routers = {};
    app.router = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, baseClassName, properties</span>) </span>{
      <span class="hljs-keyword">var</span> baseClass;
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">2</span>) {
        properties = baseClassName;
        baseClass = Router;
      } <span class="hljs-keyword">else</span> {
        baseClass = app.Routers[baseClassName];
      }

      app.Routers[name] = baseClass.extend(properties);
    };

  });


});
  Backdraft.plugin(<span class="hljs-string">"DataTable"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">plugin</span>) </span>{

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cidMap</span>(<span class="hljs-params">collection</span>) </span>{
    <span class="hljs-keyword">return</span> collection.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">model</span>) </span>{
      <span class="hljs-keyword">return</span> { cid : model.cid };
    });
  }

  <span class="hljs-keyword">var</span> ColumnConfigGenerator =  Backdraft.Utils.Class.extend({
  initialize: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">table</span>) </span>{
    <span class="hljs-keyword">this</span>.table = table;
    <span class="hljs-keyword">this</span>.columnIndexByTitle = <span class="hljs-keyword">new</span> Backbone.Model();
    <span class="hljs-keyword">this</span>.columnConfigByTitle = <span class="hljs-keyword">new</span> Backbone.Model();
    <span class="hljs-keyword">this</span>._computeColumnConfig();
    <span class="hljs-keyword">this</span>._computeColumnLookups();
    <span class="hljs-keyword">this</span>._computeSortingConfig();
  },

  columnsSwapped: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fromIndex, toIndex</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>move the config around and recompute lookup models</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> removed = <span class="hljs-keyword">this</span>.columnsConfig.splice(fromIndex, <span class="hljs-number">1</span>)[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">this</span>.columnsConfig.splice(toIndex, <span class="hljs-number">0</span>, removed);
    <span class="hljs-keyword">this</span>._computeColumnLookups();
  },

  _computeColumnConfig: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.dataTableColumns = [];
    <span class="hljs-keyword">this</span>.columnsConfig = _.clone(_.result(<span class="hljs-keyword">this</span>.table.rowClass.prototype, <span class="hljs-string">"columns"</span>));
    <span class="hljs-keyword">if</span> (!_.isArray(<span class="hljs-keyword">this</span>.columnsConfig)) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Invalid column configuration provided"</span>);
    <span class="hljs-keyword">this</span>.columnsConfig = _.reject(<span class="hljs-keyword">this</span>.columnsConfig, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">columnConfig</span>) </span>{
      <span class="hljs-keyword">if</span> (!columnConfig.present) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> !columnConfig.present();
      }
    });

    _.each(<span class="hljs-keyword">this</span>._determineColumnTypes(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">columnType, index</span>) </span>{
      <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>.columnsConfig[index];
      <span class="hljs-keyword">var</span> definition = columnType.definition()(<span class="hljs-keyword">this</span>.table, config);

      <span class="hljs-keyword">if</span> (!_.has(config, <span class="hljs-string">"required"</span>)) {
        config.required = <span class="hljs-literal">false</span>;
      }
      <span class="hljs-keyword">if</span> (!_.has(config, <span class="hljs-string">"visible"</span>)) {
        config.visible = <span class="hljs-literal">true</span>;
      }

      <span class="hljs-keyword">if</span> (config.required === <span class="hljs-literal">true</span> &amp;&amp; config.visible === <span class="hljs-literal">false</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"column can't be required, but not visible"</span>);
      }

      <span class="hljs-keyword">this</span>.dataTableColumns.push(definition);
      config.nodeMatcher = columnType.nodeMatcher();</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>use column type’s default renderer if the config doesn’t supply one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (!config.renderer) config.renderer = columnType.renderer();
    }, <span class="hljs-keyword">this</span>);
  },

  _computeSortingConfig: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> columnIndex, direction;
    <span class="hljs-keyword">this</span>.dataTableSorting = _.map(<span class="hljs-keyword">this</span>.table.sorting, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">sortConfig</span>) </span>{
      columnIndex = sortConfig[<span class="hljs-number">0</span>];
      direction = sortConfig[<span class="hljs-number">1</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>column index can be provided as the column title, convert to index</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (_.isString(columnIndex)) columnIndex = <span class="hljs-keyword">this</span>.columnIndexByTitle.get(columnIndex);
      <span class="hljs-keyword">return</span> [ columnIndex, direction ];
    }, <span class="hljs-keyword">this</span>);
  },

  _computeColumnLookups: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.columnIndexByTitle.clear();
    <span class="hljs-keyword">this</span>.columnConfigByTitle.clear();
    _.each(<span class="hljs-keyword">this</span>.columnsConfig, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">col, index</span>) </span>{
      <span class="hljs-keyword">if</span> (col.title) {
        <span class="hljs-keyword">this</span>.columnIndexByTitle.set(col.title, index);
        <span class="hljs-keyword">this</span>.columnConfigByTitle.set(col.title, col);
      }
    }, <span class="hljs-keyword">this</span>);
  },

  _determineColumnTypes: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>match our table’s columns to available column types</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> columnType, availableColumnTypes = <span class="hljs-keyword">this</span>.table.availableColumnTypes();
    <span class="hljs-keyword">return</span> _.map(<span class="hljs-keyword">this</span>.columnsConfig, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">config, index</span>) </span>{
      <span class="hljs-keyword">var</span> columnType = _.find(availableColumnTypes, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">type</span>) </span>{
        <span class="hljs-keyword">return</span> type.configMatcher()(config);
      });

      <span class="hljs-keyword">if</span> (!columnType) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"could not find matching column type: "</span> + <span class="hljs-built_in">JSON</span>.stringify(config));
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> columnType;
      }
    });
  }
});
  <span class="hljs-keyword">var</span> ColumnManager = Backdraft.Utils.Class.extend({
  initialize: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">table</span>) </span>{
    _.extend(<span class="hljs-keyword">this</span>, Backbone.Events);
    <span class="hljs-keyword">this</span>.table = table;
    <span class="hljs-keyword">this</span>.visibility = <span class="hljs-keyword">new</span> Backbone.Model();
    <span class="hljs-keyword">this</span>._configGenerator = <span class="hljs-keyword">new</span> ColumnConfigGenerator(table);
    <span class="hljs-keyword">this</span>._initEvents();
  },

  applyVisibilityPreferences: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> prefs = {};
    _.each(<span class="hljs-keyword">this</span>.columnsConfig(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">config</span>) </span>{
      <span class="hljs-keyword">if</span> (config.title) {
        prefs[config.title] = config.visible;
      }
    });
    <span class="hljs-keyword">this</span>.visibility.set(prefs);
  },

  columnAttrs: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> _.pluck(<span class="hljs-keyword">this</span>.columnsConfig(), <span class="hljs-string">"attr"</span>);
  },

  dataTableColumnsConfig: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._configGenerator.dataTableColumns;
  },

  dataTableSortingConfig: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._configGenerator.dataTableSorting;
  },

  columnsConfig: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._configGenerator.columnsConfig;
  },

  columnConfigForTitle: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">title</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._configGenerator.columnConfigByTitle.get(title);
  },

  columnsSwapped: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fromIndex, toIndex</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._configGenerator.columnsSwapped(fromIndex, toIndex);
  },

  _initEvents: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.visibility.on(<span class="hljs-string">"change"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>._applyVisibilitiesToDataTable(<span class="hljs-keyword">this</span>.visibility.changed);
      <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"change:visibility"</span>, <span class="hljs-keyword">this</span>._visibilitySummary());
    }, <span class="hljs-keyword">this</span>);
  },

  _applyVisibilitiesToDataTable: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">titleStateMap</span>) </span>{
    _.each(titleStateMap, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state, title</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>last argument of false signifies not to redraw the table</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.table.dataTable.fnSetColumnVis(<span class="hljs-keyword">this</span>._configGenerator.columnIndexByTitle.get(title), state, <span class="hljs-literal">false</span>);
    }, <span class="hljs-keyword">this</span>);
  },

  _visibilitySummary: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> summary = { visible: [], hidden: [] };
    _.each(<span class="hljs-keyword">this</span>.visibility.attributes, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state, title</span>) </span>{
      <span class="hljs-keyword">if</span> (state) summary.visible.push(title);
      <span class="hljs-keyword">else</span>       summary.hidden.push(title);
    });
    <span class="hljs-keyword">return</span> summary;
  }
});

  <span class="hljs-keyword">var</span> SelectionManager = Backdraft.Utils.Class.extend({

  initialize : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._count = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>._cidMap = {};
  },

  count : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._count;
  },

  models : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> _.values(<span class="hljs-keyword">this</span>._cidMap);
  },

  process : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">model, state</span>) </span>{
    <span class="hljs-keyword">var</span> existing = <span class="hljs-keyword">this</span>._cidMap[model.cid];
    <span class="hljs-keyword">if</span> (state) {
      <span class="hljs-keyword">if</span> (!existing) {</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>add new entry</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>._cidMap[model.cid] = model;
        <span class="hljs-keyword">this</span>._count += <span class="hljs-number">1</span>;
      }
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">if</span> (existing) {</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>purge existing entry</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>._cidMap[model.cid];
        <span class="hljs-keyword">this</span>._count = <span class="hljs-built_in">Math</span>.max(<span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>._count -<span class="hljs-number">1</span>);
      }
    }
  },

  has : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">model</span>) </span>{
    <span class="hljs-keyword">return</span> !!<span class="hljs-keyword">this</span>._cidMap[model.cid];
  }

});
  <span class="hljs-keyword">var</span> LockManager = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

  <span class="hljs-keyword">var</span> LOCKS = {
    <span class="hljs-string">"bulk"</span>:   <span class="hljs-string">"bulk selection is locked"</span>,
    <span class="hljs-string">"page"</span>:   <span class="hljs-string">"pagination is locked"</span>,
    <span class="hljs-string">"filter"</span>: <span class="hljs-string">"filtering is locked"</span>,
    <span class="hljs-string">"sort"</span>:   <span class="hljs-string">"sorting is locked"</span>
  };

  <span class="hljs-keyword">var</span> LOCK_NAMES = _.keys(LOCKS);

  <span class="hljs-keyword">var</span> LockManager = Backdraft.Utils.Class.extend({
    initialize: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">table</span>) </span>{
      _.extend(<span class="hljs-keyword">this</span>, Backbone.Events);
      <span class="hljs-keyword">this</span>.table = table;
      <span class="hljs-keyword">this</span>._states = <span class="hljs-keyword">new</span> Backbone.Model();
      <span class="hljs-keyword">this</span>._initData();
      <span class="hljs-keyword">this</span>._initEvents();
    },

    lock: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, state</span>) </span>{
      <span class="hljs-keyword">if</span> (!_.include(LOCK_NAMES, name)) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"unknown lock "</span> + name);
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">1</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>getter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._states.get(name);
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">2</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>setter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>._states.set(name, state);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"#lock requires a name and/or a state"</span>);
      }
    },

    ensureUnlocked: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) </span>{
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.lock(name)) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(LOCKS[name]);
    },

    _initData: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>all locks start as unlocked</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      _.each(LOCKS, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">v, k</span>) </span>{
        <span class="hljs-keyword">this</span>._states.set(k, <span class="hljs-literal">false</span>);
      }, <span class="hljs-keyword">this</span>);
    },

    _initEvents: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>note: the sort lock is handled by the table</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.listenTo(<span class="hljs-keyword">this</span>._states, <span class="hljs-string">"change:page"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">model, state</span>) </span>{
        <span class="hljs-keyword">this</span>.table.$(<span class="hljs-string">".dataTables_length, .dataTables_paginate"</span>).css(<span class="hljs-string">"visibility"</span>, state ? <span class="hljs-string">"hidden"</span> : <span class="hljs-string">"visible"</span>);
      });

      <span class="hljs-keyword">this</span>.listenTo(<span class="hljs-keyword">this</span>._states, <span class="hljs-string">"change:filter"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">model, state</span>) </span>{
        <span class="hljs-keyword">this</span>.table.$(<span class="hljs-string">".dataTables_filter"</span>).css(<span class="hljs-string">"visibility"</span>, state ? <span class="hljs-string">"hidden"</span> : <span class="hljs-string">"visible"</span>);
      });

      <span class="hljs-keyword">this</span>.listenTo(<span class="hljs-keyword">this</span>._states, <span class="hljs-string">"change:bulk"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">model, state</span>) </span>{
        <span class="hljs-keyword">this</span>.table.$(<span class="hljs-string">".bulk :checkbox"</span>).prop(<span class="hljs-string">"disabled"</span>, state);
      });
    }

  });

  <span class="hljs-keyword">return</span> LockManager;
})();

  <span class="hljs-keyword">var</span> ColumnType =  Backdraft.Utils.Class.extend({
  initialize: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._getterSetter(<span class="hljs-string">"configMatcher"</span>);
    <span class="hljs-keyword">this</span>._getterSetter(<span class="hljs-string">"nodeMatcher"</span>);
    <span class="hljs-keyword">this</span>._getterSetter(<span class="hljs-string">"definition"</span>);
    <span class="hljs-keyword">this</span>._getterSetter(<span class="hljs-string">"renderer"</span>);
  }
});

  <span class="hljs-keyword">var</span> Row = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

  <span class="hljs-keyword">var</span> Base = Backdraft.plugin(<span class="hljs-string">"Base"</span>);

  <span class="hljs-keyword">var</span> Row = Base.View.extend({
    initialize: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>) </span>{
      <span class="hljs-keyword">this</span>.columnsConfig = options.columnsConfig;
      <span class="hljs-keyword">this</span>.$el.data(<span class="hljs-string">"row"</span>, <span class="hljs-keyword">this</span>);
    },

    render : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> cells = <span class="hljs-keyword">this</span>.findCells(), node;
      _.each(<span class="hljs-keyword">this</span>.columnsConfig, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">config</span>) </span>{
        node = cells.filter(config.nodeMatcher(config));
        <span class="hljs-keyword">this</span>._invokeRenderer(config, node);
      }, <span class="hljs-keyword">this</span>);
    },

    renderColumnByConfig: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">config</span>) </span>{
      <span class="hljs-keyword">var</span> node = <span class="hljs-keyword">this</span>.findCells().filter(config.nodeMatcher(config));
      <span class="hljs-keyword">this</span>._invokeRenderer(config, node);
    },

    bulkState : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>TODO: throw error when no checkbox</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.checkbox) <span class="hljs-keyword">return</span>;

      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">1</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>setter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.checkbox.prop(<span class="hljs-string">"checked"</span>, state);
        <span class="hljs-keyword">this</span>.$el.toggleClass(<span class="hljs-string">"backdraft-selected"</span>, state);
      } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>getter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.checkbox.prop(<span class="hljs-string">"checked"</span>);
      }
    },

    findCells: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.$el.find(<span class="hljs-string">"td"</span>);
    },

    renderers : {
    },

    _invokeRenderer: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">config, node</span>) </span>{
      <span class="hljs-keyword">if</span> (node.length === <span class="hljs-number">1</span>) {
        config.renderer.call(<span class="hljs-keyword">this</span>, node, config);
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (node.length &gt; <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"multiple nodes were matched"</span>);
      }
    }

  }, {

    finalize : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, rowClass</span>) </span>{
    }

  });

  <span class="hljs-keyword">return</span> Row;

})();
  <span class="hljs-keyword">var</span> LocalDataTable = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

  <span class="hljs-keyword">var</span> Base = Backdraft.plugin(<span class="hljs-string">"Base"</span>);

  <span class="hljs-keyword">var</span> LocalDataTable = Base.View.extend({

    template : <span class="hljs-string">'\
      &lt;table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered"&gt;&lt;/table&gt;\
    '</span>,

    constructor : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>) </span>{
      <span class="hljs-keyword">this</span>.options = options || {};</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>copy over certain properties from options to the table itself</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      _.extend(<span class="hljs-keyword">this</span>, _.pick(<span class="hljs-keyword">this</span>.options, [ <span class="hljs-string">"selectedIds"</span> ]));
      _.bindAll(<span class="hljs-keyword">this</span>, <span class="hljs-string">"_onRowCreated"</span>, <span class="hljs-string">"_onBulkHeaderClick"</span>, <span class="hljs-string">"_onBulkRowClick"</span>, <span class="hljs-string">"_bulkCheckboxAdjust"</span>, <span class="hljs-string">"_onDraw"</span>, <span class="hljs-string">"_onColumnVisibilityChange"</span>);
      <span class="hljs-keyword">this</span>.cache = <span class="hljs-keyword">new</span> Base.Cache();
      <span class="hljs-keyword">this</span>.selectionManager = <span class="hljs-keyword">new</span> SelectionManager();
      <span class="hljs-keyword">this</span>.rowClass = <span class="hljs-keyword">this</span>.options.rowClass || <span class="hljs-keyword">this</span>._resolveRowClass();
      <span class="hljs-keyword">this</span>._applyDefaults();
      <span class="hljs-keyword">this</span>._columnManager = <span class="hljs-keyword">new</span> ColumnManager(<span class="hljs-keyword">this</span>);
      <span class="hljs-keyword">this</span>._lockManager = <span class="hljs-keyword">new</span> LockManager(<span class="hljs-keyword">this</span>);
      LocalDataTable.__super__.constructor.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
      <span class="hljs-keyword">this</span>.listenTo(<span class="hljs-keyword">this</span>.collection, <span class="hljs-string">"add"</span>, <span class="hljs-keyword">this</span>._onAdd);
      <span class="hljs-keyword">this</span>.listenTo(<span class="hljs-keyword">this</span>.collection, <span class="hljs-string">"remove"</span>, <span class="hljs-keyword">this</span>._onRemove);
      <span class="hljs-keyword">this</span>.listenTo(<span class="hljs-keyword">this</span>.collection, <span class="hljs-string">"reset"</span>, <span class="hljs-keyword">this</span>._onReset);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>apply filtering</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    filter : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>._lockManager.ensureUnlocked(<span class="hljs-string">"filter"</span>);
      <span class="hljs-keyword">this</span>.dataTable.fnFilter.apply(<span class="hljs-keyword">this</span>.dataTable, <span class="hljs-built_in">arguments</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>change pagination</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    page : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>._lockManager.ensureUnlocked(<span class="hljs-string">"page"</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.dataTable.fnPageChange.apply(<span class="hljs-keyword">this</span>.dataTable, <span class="hljs-built_in">arguments</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>sort specific columns</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    sort : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>._lockManager.ensureUnlocked(<span class="hljs-string">"sort"</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.dataTable.fnSort.apply(<span class="hljs-keyword">this</span>.dataTable, <span class="hljs-built_in">arguments</span>);
    },

    selectedModels : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>._lockManager.ensureUnlocked(<span class="hljs-string">"bulk"</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.selectionManager.models();
    },

    render : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>.$el.html(<span class="hljs-keyword">this</span>.template);
      <span class="hljs-keyword">this</span>._dataTableCreate();
      <span class="hljs-keyword">this</span>._initBulkHandling();
      <span class="hljs-keyword">this</span>.paginate &amp;&amp; <span class="hljs-keyword">this</span>._initPaginationHandling();
      <span class="hljs-keyword">this</span>._triggerChangeSelection();
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    },

    renderColumn: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">title</span>) </span>{
      <span class="hljs-keyword">var</span> config = <span class="hljs-keyword">this</span>._columnManager.columnConfigForTitle(title);
      <span class="hljs-keyword">if</span> (!config) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"column not found"</span>);
      }
      <span class="hljs-keyword">this</span>.cache.each(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">row</span>) </span>{
        row.renderColumnByConfig(config);
      });
    },

    selectAllVisible : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">state</span>) </span>{
      <span class="hljs-keyword">this</span>._lockManager.ensureUnlocked(<span class="hljs-string">"bulk"</span>);
      <span class="hljs-keyword">this</span>.bulkCheckbox.prop(<span class="hljs-string">"checked"</span>, state);
      _.each(<span class="hljs-keyword">this</span>._visibleRowsOnCurrentPage(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">row</span>) </span>{
        <span class="hljs-keyword">this</span>._setRowSelectedState(row.model, row, state);
      }, <span class="hljs-keyword">this</span>);
      <span class="hljs-keyword">this</span>._triggerChangeSelection({ selectAllVisible: state });
    },

    selectAllMatching : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>._lockManager.ensureUnlocked(<span class="hljs-string">"bulk"</span>);
      <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.paginate) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"#selectAllMatching can only be used with paginated tables"</span>);
      _.each(<span class="hljs-keyword">this</span>._allMatchingModels(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">model</span>) </span>{
        <span class="hljs-keyword">this</span>._setRowSelectedState(model, <span class="hljs-keyword">this</span>.cache.get(model), <span class="hljs-literal">true</span>);
      }, <span class="hljs-keyword">this</span>);
      <span class="hljs-keyword">this</span>._triggerChangeSelection();
    },

    matchingCount : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>._lockManager.ensureUnlocked(<span class="hljs-string">"bulk"</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.dataTable.fnSettings().aiDisplay.length;
    },

    totalRecordsCount: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>._lockManager.ensureUnlocked(<span class="hljs-string">"bulk"</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.dataTable.fnSettings().fnRecordsTotal();
    },

    columnVisibility: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">title, state</span>) </span>{
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">1</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>getter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._columnManager.visibility.get(title);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span> (!state &amp;&amp; <span class="hljs-keyword">this</span>._columnManager.columnConfigForTitle(title).required) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"can not disable visibility when column is required"</span>);
        }
        <span class="hljs-keyword">this</span>._columnManager.visibility.set(title, state);
        state &amp;&amp; <span class="hljs-keyword">this</span>.renderColumn(title);
      }
    },

    restoreColumnVisibility: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      _.each(<span class="hljs-keyword">this</span>.columnsConfig(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">column</span>) </span>{
        <span class="hljs-keyword">if</span> (column.title) {
          <span class="hljs-keyword">this</span>.columnVisibility(column.title, column.visible);
        }
      }, <span class="hljs-keyword">this</span>);
    },

    lock: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, state</span>) </span>{
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">1</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>getter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._lockManager.lock(name);
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">2</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>setter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>._lockManager.lock(name, state);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"#lock requires a name and/or a state"</span>);
      }
    },

    columnsConfig: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._columnManager.columnsConfig();
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Private APIs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    _enableReorderableColumns: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
      <span class="hljs-keyword">new</span> $.fn.dataTable.ColReorder(<span class="hljs-keyword">this</span>.dataTable, {
        fnReorderCallback: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fromIndex, toIndex</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>notify that columns have been externally rearranged</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          self._columnManager.columnsSwapped(fromIndex, toIndex);
        }
      });
    },

    _allMatchingModels : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>returns all models matching the current filter criteria, regardless of pagination
since we are using deferred rendering, the dataTable.$ and dataTable._ methods don’t return all
matching data since some of the rows may not have been rendered yet.
here we use the the aiDisplay property to get indecies of the data matching the currenting filtering
and return the associated models</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">return</span> _.map(<span class="hljs-keyword">this</span>.dataTable.fnSettings().aiDisplay, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">index</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.collection.at(index);
      }, <span class="hljs-keyword">this</span>);
    },

    _applyDefaults : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      _.defaults(<span class="hljs-keyword">this</span>, {
        paginate : <span class="hljs-literal">true</span>,
        paginateLengthMenu : [ <span class="hljs-number">10</span>, <span class="hljs-number">25</span>, <span class="hljs-number">50</span>, <span class="hljs-number">100</span> ],
        paginateLength : <span class="hljs-number">10</span>,
        selectedIds : [],
        layout : <span class="hljs-string">"&lt;'row'&lt;'col-xs-6'l&gt;&lt;'col-xs-6'f&gt;r&gt;t&lt;'row'&lt;'col-xs-6'i&gt;&lt;'col-xs-6'p&gt;&gt;"</span>,
        reorderableColumns: <span class="hljs-literal">true</span>,
        objectName: {
          singular: <span class="hljs-string">"row"</span>,
          plural: <span class="hljs-string">"rows"</span>
        }
      });
      _.defaults(<span class="hljs-keyword">this</span>, {
        sorting : [ [ <span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.paginate ? <span class="hljs-string">"desc"</span> : <span class="hljs-string">"asc"</span> ] ]
      });

      <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.objectName.plural) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"plural object name must be provided"</span>);
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.objectName.singular) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"singular object name must be provided"</span>);
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>returns row objects that have not been filtered out and are on the current page</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _visibleRowsOnCurrentPage : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>non-paginated tables will return all rows, ignoring the page param</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> visibleRowsCurrentPageArgs = { filter : <span class="hljs-string">"applied"</span>, page : <span class="hljs-string">"current"</span> };
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.dataTable.$(<span class="hljs-string">"tr"</span>, visibleRowsCurrentPageArgs).map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">index, node</span>) </span>{
        <span class="hljs-keyword">return</span> $(node).data(<span class="hljs-string">"row"</span>);
      });
    },

    _setRowSelectedState : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">model, row, state</span>) </span>{
      <span class="hljs-keyword">this</span>.selectionManager.process(model, state);</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>the row may not exist yet as we utilize deferred rendering. we track the model as
selected and make the ui reflect this when the row is finally created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      row &amp;&amp; row.bulkState(state);
    },

    _dataTableCreate : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>.dataTable = <span class="hljs-keyword">this</span>.$(<span class="hljs-string">"table"</span>).dataTable(<span class="hljs-keyword">this</span>._dataTableConfig());
      <span class="hljs-keyword">this</span>._installSortInterceptors();
      <span class="hljs-keyword">this</span>.reorderableColumns &amp;&amp; <span class="hljs-keyword">this</span>._enableReorderableColumns();
      <span class="hljs-keyword">this</span>._columnManager.on(<span class="hljs-string">"change:visibility"</span>, <span class="hljs-keyword">this</span>._onColumnVisibilityChange);
      <span class="hljs-keyword">this</span>._columnManager.applyVisibilityPreferences()
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.collection.length) <span class="hljs-keyword">this</span>._onReset(<span class="hljs-keyword">this</span>.collection);
    },

    _areAllVisibleRowsSelected : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> allSelected, visibleRows = <span class="hljs-keyword">this</span>._visibleRowsOnCurrentPage();
      <span class="hljs-keyword">if</span> (visibleRows.length) {
        allSelected = _.all(visibleRows, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">row</span>) </span>{
          <span class="hljs-keyword">return</span> row.bulkState() === <span class="hljs-literal">true</span>;
        });
      } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>have no selections does not count as having all selected</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        allSelected = <span class="hljs-literal">false</span>;
      }
      <span class="hljs-keyword">return</span> allSelected;
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>when changing between pages / filters we set the header bulk checkbox state based on whether all newly visible rows are selected or not
note: we defer execution as the “page” and “filter” events are called before new rows are swapped in
this allows our code to run after the all the new rows are inserted</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _bulkCheckboxAdjust : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
      <span class="hljs-keyword">if</span> (!self.bulkCheckbox) <span class="hljs-keyword">return</span>;
      _.defer(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        self.bulkCheckbox.prop(<span class="hljs-string">"checked"</span>, self._areAllVisibleRowsSelected());
      });
    },

    _initPaginationHandling : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>.dataTable.on(<span class="hljs-string">"page"</span>, <span class="hljs-keyword">this</span>._bulkCheckboxAdjust);
    },

    _initBulkHandling : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> bulkCheckbox = <span class="hljs-keyword">this</span>.$el.find(<span class="hljs-string">"th.bulk :checkbox"</span>);
      <span class="hljs-keyword">if</span> (!bulkCheckbox.length) <span class="hljs-keyword">return</span>
      <span class="hljs-keyword">this</span>.bulkCheckbox = bulkCheckbox;
      <span class="hljs-keyword">this</span>.bulkCheckbox.click(<span class="hljs-keyword">this</span>._onBulkHeaderClick);
      <span class="hljs-keyword">this</span>.dataTable.on(<span class="hljs-string">"click"</span>, <span class="hljs-string">"td.bulk :checkbox"</span>, <span class="hljs-keyword">this</span>._onBulkRowClick);
      <span class="hljs-keyword">this</span>.dataTable.on(<span class="hljs-string">"filter"</span>, <span class="hljs-keyword">this</span>._bulkCheckboxAdjust);
    },

    _dataTableConfig : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> {
        sDom : <span class="hljs-keyword">this</span>.layout,
        bDeferRender : <span class="hljs-literal">true</span>,
        bPaginate : <span class="hljs-keyword">this</span>.paginate,
        aLengthMenu : <span class="hljs-keyword">this</span>.paginateLengthMenu,
        iDisplayLength : <span class="hljs-keyword">this</span>.paginateLength,
        bInfo : <span class="hljs-literal">true</span>,
        fnCreatedRow : <span class="hljs-keyword">this</span>._onRowCreated,
        aoColumns : <span class="hljs-keyword">this</span>._columnManager.dataTableColumnsConfig(),
        aaSorting : <span class="hljs-keyword">this</span>._columnManager.dataTableSortingConfig(),
        fnDrawCallback : <span class="hljs-keyword">this</span>._onDraw
      };
    },

    _triggerChangeSelection: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">extraData</span>) </span>{
      <span class="hljs-keyword">var</span> data = _.extend(extraData || {}, { count : <span class="hljs-keyword">this</span>.selectionManager.count() });
      <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"change:selected"</span>, data);
    },

    _installSortInterceptors: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>dataTables does not provide a good way to programmatically disable sorting, so we:
1) remove the default sorting event handler that dataTables adds
2) insert our own that stops the event if we are locked
3) re-insert the dataTables sort event handler</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
      <span class="hljs-keyword">this</span>.dataTable.find(<span class="hljs-string">"thead th"</span>).each(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">index</span>) </span>{
        $(<span class="hljs-keyword">this</span>).off(<span class="hljs-string">"click.DT"</span>).on(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
          <span class="hljs-keyword">if</span> (self.lock(<span class="hljs-string">"sort"</span>)) {
            event.stopImmediatePropagation();
          }
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>default sort handler for column with index</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        self.dataTable.fnSortListener($(<span class="hljs-keyword">this</span>), index);
      });
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    _onDraw : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"draw"</span>, <span class="hljs-built_in">arguments</span>);
    },

    _onColumnVisibilityChange: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">summary</span>) </span>{
      <span class="hljs-keyword">this</span>.dataTable.find(<span class="hljs-string">".dataTables_empty"</span>).attr(<span class="hljs-string">"colspan"</span>, summary.visible.length);
    },

    _onBulkHeaderClick : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
      <span class="hljs-keyword">var</span> state = <span class="hljs-keyword">this</span>.bulkCheckbox.prop(<span class="hljs-string">"checked"</span>);
      <span class="hljs-keyword">this</span>.selectAllVisible(state);</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>don’t let dataTables sort this column on the click of checkbox</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      event.stopPropagation();
    },

    _onBulkRowClick : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
      <span class="hljs-keyword">var</span> checkbox = $(event.target), row = checkbox.closest(<span class="hljs-string">"tr"</span>).data(<span class="hljs-string">"row"</span>), checked = checkbox.prop(<span class="hljs-string">"checked"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>ensure that when a single row checkbox is unchecked, we uncheck the header bulk checkbox</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (!checked) <span class="hljs-keyword">this</span>.bulkCheckbox.prop(<span class="hljs-string">"checked"</span>, <span class="hljs-literal">false</span>);
      <span class="hljs-keyword">this</span>._setRowSelectedState(row.model, row, checked);
      <span class="hljs-keyword">this</span>._triggerChangeSelection();
    },

    _onRowCreated : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">node, data</span>) </span>{
      <span class="hljs-keyword">var</span> model = <span class="hljs-keyword">this</span>.collection.get(data);
      <span class="hljs-keyword">var</span> row = <span class="hljs-keyword">new</span> <span class="hljs-keyword">this</span>.rowClass({
        el : node,
        model : model,
        columnsConfig: <span class="hljs-keyword">this</span>.columnsConfig()
      });
      <span class="hljs-keyword">this</span>.cache.set(model, row);
      <span class="hljs-keyword">this</span>.child(<span class="hljs-string">"child"</span> + row.cid, row).render();</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>due to deferred rendering, the model associated with the row may have already been selected, but not rendered yet.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.selectionManager.has(model) &amp;&amp; row.bulkState(<span class="hljs-literal">true</span>);
    },

    _onAdd : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">model</span>) </span>{
      <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.dataTable) <span class="hljs-keyword">return</span>;
      <span class="hljs-keyword">this</span>.dataTable.fnAddData({ cid : model.cid })
      <span class="hljs-keyword">this</span>._triggerChangeSelection();
    },

    _onRemove : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">model</span>) </span>{
      <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.dataTable) <span class="hljs-keyword">return</span>;
      <span class="hljs-keyword">var</span> cache = <span class="hljs-keyword">this</span>.cache, row = cache.get(model);
      <span class="hljs-keyword">this</span>.dataTable.fnDeleteRow(row.el, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        cache.unset(model);
        row.close();
      });
      <span class="hljs-keyword">this</span>._triggerChangeSelection();
    },

    _onReset : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">collection</span>) </span>{
      <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.dataTable) <span class="hljs-keyword">return</span>;
      <span class="hljs-keyword">this</span>.dataTable.fnClearTable();
      <span class="hljs-keyword">this</span>.cache.each(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">row</span>) </span>{
        row.close();
      });
      <span class="hljs-keyword">this</span>.cache.reset();</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>populate with preselected items</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.selectionManager = <span class="hljs-keyword">new</span> SelectionManager();
      _.each(<span class="hljs-keyword">this</span>.selectedIds, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">id</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>its possible that a selected id is provided for a model that doesn’t actually exist in the table, ignore it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> selectedModel = <span class="hljs-keyword">this</span>.collection.get(id);
        selectedModel &amp;&amp; <span class="hljs-keyword">this</span>._setRowSelectedState(selectedModel, <span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>);
      }, <span class="hljs-keyword">this</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>add new data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.dataTable.fnAddData(cidMap(collection));
      <span class="hljs-keyword">this</span>._triggerChangeSelection();
    }

  }, {

    finalize : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, tableClass, views, pluginConfig, appName</span>) </span>{
      <span class="hljs-keyword">if</span> (tableClass.prototype.rowClassName) {</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>method for late resolution of row class, removes dependency on needing access to the entire app</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        tableClass.prototype._resolveRowClass = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
          <span class="hljs-keyword">return</span> views[tableClass.prototype.rowClassName];
        };
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>return all registered column types</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      tableClass.prototype.availableColumnTypes = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> pluginConfig.columnTypes;
      };

      tableClass.prototype._triggerGlobalEvent = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">eventName, args</span>) </span>{
        $(<span class="hljs-string">"body"</span>).trigger(appName + <span class="hljs-string">":"</span> + eventName, args);
      }
    }

  });

  <span class="hljs-keyword">return</span> LocalDataTable;

})();

  <span class="hljs-keyword">var</span> ServerSideDataTable = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

  <span class="hljs-keyword">var</span> ServerSideDataTable = LocalDataTable.extend({

    constructor : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>force pagination</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.paginate = <span class="hljs-literal">true</span>;
      ServerSideDataTable.__super__.constructor.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.collection.length !== <span class="hljs-number">0</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Server side dataTables requires an empty collection"</span>);
      <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.collection.url) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Server side dataTables require the collection to define a url"</span>);
      _.bindAll(<span class="hljs-keyword">this</span>, <span class="hljs-string">"_fetchServerData"</span>, <span class="hljs-string">"_addServerParams"</span>, <span class="hljs-string">"_onDraw"</span>);
      <span class="hljs-keyword">this</span>.serverParams({});
      <span class="hljs-keyword">this</span>.selectAllMatching(<span class="hljs-literal">false</span>);
    },

    selectAllMatching : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">val</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>getter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._selectAllMatchingParams;</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>setter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (val) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dataTable.fnPagingInfo().iTotalPages &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"#selectAllMatching cannot be used when there are no additional paginated results"</span>);
        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>._areAllVisibleRowsSelected()) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"all rows must be selected before calling #selectAllMatching"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>store current server params</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>._selectAllMatchingParams = <span class="hljs-keyword">this</span>.serverParams();
      } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>clear stored server params</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>._selectAllMatchingParams = <span class="hljs-literal">null</span>;
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>get / set additional params that should be passed as part of the ajax request</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    serverParams : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">params</span>) </span>{
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">this</span>._serverParams = params;
        <span class="hljs-keyword">this</span>.reload();
      } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>make a clone so that params aren’t inadvertently modified externally</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> _.clone(<span class="hljs-keyword">this</span>._serverParams);
      }
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>reload data from the server</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    reload : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>.dataTable &amp;&amp; <span class="hljs-keyword">this</span>.dataTable.fnDraw();
    },

    _onAdd : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Server side dataTables do not allow adding to the collection"</span>);
    },

    _onRemove : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Server side dataTables do not allow removing from collection"</span>)
    },

    _onReset : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">collection, options</span>) </span>{
      <span class="hljs-keyword">if</span> (!options.addData) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"An addData option is required to reset the collection"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>clean up old data
note: since we have enabled server-side processing, we don’t need to call
fnClearTable here - it is a client-side only function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.cache.each(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">row</span>) </span>{
        row.close();
      });
      <span class="hljs-keyword">this</span>.cache.reset();
      <span class="hljs-keyword">this</span>.selectionManager = <span class="hljs-keyword">new</span> SelectionManager();</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>actually add new data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      options.addData(cidMap(collection));
      <span class="hljs-keyword">this</span>._triggerChangeSelection();
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>dataTables callback to allow addition of params to the ajax request</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _addServerParams : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">aoData</span>) </span>{
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>._serverParams) {
        aoData.push({ name : key, value : <span class="hljs-keyword">this</span>._serverParams[key] });
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>add column attribute mappings as a parameter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      _.each(<span class="hljs-keyword">this</span>._columnManager.columnAttrs(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">attr</span>) </span>{
        aoData.push({ name: <span class="hljs-string">"column_attrs[]"</span>, value: attr });
      });
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>dataTables callback after a draw event has occurred</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _onDraw : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>anytime a draw occurrs (pagination change, pagination size change, sorting, etc) we want
to clear out any stored selectAllMatchingParams and reset the bulk select checbox</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.selectAllMatching(<span class="hljs-literal">false</span>);
      <span class="hljs-keyword">this</span>.bulkCheckbox &amp;&amp; <span class="hljs-keyword">this</span>.bulkCheckbox.prop(<span class="hljs-string">"checked"</span>, <span class="hljs-literal">false</span>);
      <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">"draw"</span>, <span class="hljs-built_in">arguments</span>);
    },

    _fetchServerData : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">sUrl, aoData, fnCallback, oSettings</span>) </span>{
      <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
      oSettings.jqXHR = $.ajax({
        url : sUrl,
        data : aoData,
        dataType : <span class="hljs-string">"json"</span>,
        cache : <span class="hljs-literal">false</span>,
        type : <span class="hljs-keyword">this</span>.ajaxMethod || <span class="hljs-string">"GET"</span>,
        beforeSend: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">xhr</span>) </span>{
          xhr.setRequestHeader(<span class="hljs-string">'X-Backdraft'</span>, <span class="hljs-string">"1"</span>);
          self._triggerGlobalEvent(<span class="hljs-string">"ajax-start.backdraft"</span>, [xhr, self]);
        },
        success : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">json</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>ensure we ignore old Ajax responses
this piece of logic was taken from the _fnAjaxUpdateDraw method of dataTables, which is
what gets called by fnCallback. However, fnCallback should only be invoked after we reset the
collection, so we must perform the check at this point as well.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">if</span> (_.isUndefined(json.sEcho)) <span class="hljs-keyword">return</span>;
          <span class="hljs-keyword">if</span> (json.sEcho * <span class="hljs-number">1</span> &lt; oSettings.iDraw) <span class="hljs-keyword">return</span>;

          self.collection.reset(json.aaData, {
            addData : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>calling fnCallback is what will actually cause the data to be populated</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              json.aaData = data;
              fnCallback(json)
            }
          });
        },
        complete: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">xhr, status</span>) </span>{
          self._triggerGlobalEvent(<span class="hljs-string">"ajax-finish.backdraft"</span>, [xhr, status, self, aoData]);
        }
      });
    },

    _dataTableConfig : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">var</span> config = ServerSideDataTable.__super__._dataTableConfig.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>add server side related options</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">return</span> _.extend(config, {
        bProcessing : <span class="hljs-literal">true</span>,
        bServerSide : <span class="hljs-literal">true</span>,
        sAjaxSource : _.result(<span class="hljs-keyword">this</span>.collection, <span class="hljs-string">"url"</span>),
        fnServerData : <span class="hljs-keyword">this</span>._fetchServerData,
        fnServerParams : <span class="hljs-keyword">this</span>._addServerParams,
        fnDrawCallback : <span class="hljs-keyword">this</span>._onDraw,
        oLanguage: {
          sProcessing: <span class="hljs-keyword">this</span>.processingText,
          sEmptyTable: <span class="hljs-keyword">this</span>.emptyText
        }
      });
    },

    _dataTableCreate : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">try</span> {
        ServerSideDataTable.__super__._dataTableCreate.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
      } <span class="hljs-keyword">catch</span>(ex) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Unable to create ServerSide dataTable. Does your layout template have the 'r' setting for showing the processing status? Exception: "</span> + ex.message);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>hide inefficient filter</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.$(<span class="hljs-string">".dataTables_filter"</span>).css(<span class="hljs-string">"visibility"</span>, <span class="hljs-string">"hidden"</span>);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>overridden and will be handled via the _onDraw callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _initPaginationHandling: $.noop,</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>overridden and will be handled via the _onDraw callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _bulkCheckboxAdjust: $.noop,

    _initBulkHandling : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      ServerSideDataTable.__super__._initBulkHandling.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>whenever selections change, clear out stored server params</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.on(<span class="hljs-string">"change:selected"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">this</span>.selectAllMatching(<span class="hljs-literal">false</span>);
      }, <span class="hljs-keyword">this</span>);
    },

    _visibleRowsOnCurrentPage : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>serverSide dataTables have a bug finding rows when the “page” param is provided on pages other than the first one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> visibleRowsCurrentPageArgs = { filter : <span class="hljs-string">"applied"</span> };
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.dataTable.$(<span class="hljs-string">"tr"</span>, visibleRowsCurrentPageArgs).map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">index, node</span>) </span>{
        <span class="hljs-keyword">return</span> $(node).data(<span class="hljs-string">"row"</span>);
      });
    }

  });

  <span class="hljs-keyword">return</span> ServerSideDataTable;

})();


  plugin.initializer(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">app</span>) </span>{

    <span class="hljs-comment">/* Set the defaults for DataTables initialisation */</span>
$.extend( <span class="hljs-literal">true</span>, $.fn.dataTable.defaults, {
  <span class="hljs-string">"sDom"</span>:
    <span class="hljs-string">"&lt;'row'&lt;'col-xs-6'l&gt;&lt;'col-xs-6'f&gt;r&gt;"</span>+
    <span class="hljs-string">"t"</span>+
    <span class="hljs-string">"&lt;'row'&lt;'col-xs-6'i&gt;&lt;'col-xs-6'p&gt;&gt;"</span>,
  <span class="hljs-string">"oLanguage"</span>: {
    <span class="hljs-string">"sLengthMenu"</span>: <span class="hljs-string">"_MENU_ records per page"</span>,
    <span class="hljs-string">"sInfoFiltered"</span> : <span class="hljs-string">"&lt;br/&gt;(filtered from _MAX_ total)"</span>
  }
} );


<span class="hljs-comment">/* Default class modification */</span>
$.extend( $.fn.dataTableExt.oStdClasses, {
  <span class="hljs-string">"sWrapper"</span>: <span class="hljs-string">"dataTables_wrapper form-inline"</span>,
  <span class="hljs-string">"sFilterInput"</span>: <span class="hljs-string">"form-control input-sm"</span>,
  <span class="hljs-string">"sLengthSelect"</span>: <span class="hljs-string">"form-control input-sm"</span>
} );</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>Integration for 1.9-</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>$.fn.dataTable.defaults.sPaginationType = <span class="hljs-string">'bootstrap'</span>;

<span class="hljs-comment">/* API method to get paging information */</span>
$.fn.dataTableExt.oApi.fnPagingInfo = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> oSettings </span>)
</span>{
  <span class="hljs-keyword">return</span> {
    <span class="hljs-string">"iStart"</span>:         oSettings._iDisplayStart,
    <span class="hljs-string">"iEnd"</span>:           oSettings.fnDisplayEnd(),
    <span class="hljs-string">"iLength"</span>:        oSettings._iDisplayLength,
    <span class="hljs-string">"iTotal"</span>:         oSettings.fnRecordsTotal(),
    <span class="hljs-string">"iFilteredTotal"</span>: oSettings.fnRecordsDisplay(),
    <span class="hljs-string">"iPage"</span>:          oSettings._iDisplayLength === -<span class="hljs-number">1</span> ?
      <span class="hljs-number">0</span> : <span class="hljs-built_in">Math</span>.ceil( oSettings._iDisplayStart / oSettings._iDisplayLength ),
    <span class="hljs-string">"iTotalPages"</span>:    oSettings._iDisplayLength === -<span class="hljs-number">1</span> ?
      <span class="hljs-number">0</span> : <span class="hljs-built_in">Math</span>.ceil( oSettings.fnRecordsDisplay() / oSettings._iDisplayLength )
  };
};

<span class="hljs-comment">/* Bootstrap style pagination control */</span>
$.extend( $.fn.dataTableExt.oPagination, {
  <span class="hljs-string">"bootstrap"</span>: {
    <span class="hljs-string">"fnInit"</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> oSettings, nPaging, fnDraw </span>) </span>{
      <span class="hljs-keyword">var</span> oLang = oSettings.oLanguage.oPaginate;
      <span class="hljs-keyword">var</span> fnClickHandler = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> e </span>) </span>{
        e.preventDefault();</pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <p>prevent clicks on disabled links</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ($(e.target).closest(<span class="hljs-string">"li"</span>).is(<span class="hljs-string">".disabled"</span>)) {
          <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">if</span> ( oSettings.oApi._fnPageChange(oSettings, e.data.action) ) {
          fnDraw( oSettings );
        }
      };

      $(nPaging).append(
        <span class="hljs-string">'&lt;ul class="pagination pagination-sm"&gt;'</span>+
          <span class="hljs-string">'&lt;li class="prev disabled"&gt;&lt;a href="#"&gt;&amp;larr; &lt;/a&gt;&lt;/li&gt;'</span>+
          <span class="hljs-string">'&lt;li class="next disabled"&gt;&lt;a href="#"&gt; &amp;rarr; &lt;/a&gt;&lt;/li&gt;'</span>+
        <span class="hljs-string">'&lt;/ul&gt;'</span>
      );
      <span class="hljs-keyword">var</span> els = $(<span class="hljs-string">'a'</span>, nPaging);
      $(els[<span class="hljs-number">0</span>]).bind( <span class="hljs-string">'click.DT'</span>, { action: <span class="hljs-string">"previous"</span> }, fnClickHandler );
      $(els[<span class="hljs-number">1</span>]).bind( <span class="hljs-string">'click.DT'</span>, { action: <span class="hljs-string">"next"</span> }, fnClickHandler );
    },

    <span class="hljs-string">"fnUpdate"</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> oSettings, fnDraw </span>) </span>{
      <span class="hljs-keyword">var</span> iListLength = <span class="hljs-number">5</span>;
      <span class="hljs-keyword">var</span> oPaging = oSettings.oInstance.fnPagingInfo();
      <span class="hljs-keyword">var</span> an = oSettings.aanFeatures.p;
      <span class="hljs-keyword">var</span> i, ien, j, sClass, iStart, iEnd, iHalf=<span class="hljs-built_in">Math</span>.floor(iListLength/<span class="hljs-number">2</span>);

      <span class="hljs-keyword">if</span> ( oPaging.iTotalPages &lt; iListLength) {
        iStart = <span class="hljs-number">1</span>;
        iEnd = oPaging.iTotalPages;
      }
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( oPaging.iPage &lt;= iHalf ) {
        iStart = <span class="hljs-number">1</span>;
        iEnd = iListLength;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( oPaging.iPage &gt;= (oPaging.iTotalPages-iHalf) ) {
        iStart = oPaging.iTotalPages - iListLength + <span class="hljs-number">1</span>;
        iEnd = oPaging.iTotalPages;
      } <span class="hljs-keyword">else</span> {
        iStart = oPaging.iPage - iHalf + <span class="hljs-number">1</span>;
        iEnd = iStart + iListLength - <span class="hljs-number">1</span>;
      }

      <span class="hljs-keyword">for</span> ( i=<span class="hljs-number">0</span>, ien=an.length ; i&lt;ien ; i++ ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <p>Remove the middle elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        $(<span class="hljs-string">'li:gt(0)'</span>, an[i]).filter(<span class="hljs-string">':not(:last)'</span>).remove();</pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <p>Add the new list items and their event handlers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">for</span> ( j=iStart ; j&lt;=iEnd ; j++ ) {
          sClass = (j==oPaging.iPage+<span class="hljs-number">1</span>) ? <span class="hljs-string">'class="active"'</span> : <span class="hljs-string">''</span>;
          $(<span class="hljs-string">'&lt;li '</span>+sClass+<span class="hljs-string">'&gt;&lt;a href="#"&gt;'</span>+j+<span class="hljs-string">'&lt;/a&gt;&lt;/li&gt;'</span>)
            .insertBefore( $(<span class="hljs-string">'li:last'</span>, an[i])[<span class="hljs-number">0</span>] )
            .bind(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
              e.preventDefault();</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p>EUGE - patched to make sure the “page” event is fired when numbers are clicked</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              oSettings.oInstance.fnPageChange(<span class="hljs-built_in">parseInt</span>($(<span class="hljs-string">'a'</span>, <span class="hljs-keyword">this</span>).text(),<span class="hljs-number">10</span>)-<span class="hljs-number">1</span>);
            } );
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <p>Add / remove disabled classes from the static elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ( oPaging.iPage === <span class="hljs-number">0</span> ) {
          $(<span class="hljs-string">'li:first'</span>, an[i]).addClass(<span class="hljs-string">'disabled'</span>);
        } <span class="hljs-keyword">else</span> {
          $(<span class="hljs-string">'li:first'</span>, an[i]).removeClass(<span class="hljs-string">'disabled'</span>);
        }

        <span class="hljs-keyword">if</span> ( oPaging.iPage === oPaging.iTotalPages-<span class="hljs-number">1</span> || oPaging.iTotalPages === <span class="hljs-number">0</span> ) {
          $(<span class="hljs-string">'li:last'</span>, an[i]).addClass(<span class="hljs-string">'disabled'</span>);
        } <span class="hljs-keyword">else</span> {
          $(<span class="hljs-string">'li:last'</span>, an[i]).removeClass(<span class="hljs-string">'disabled'</span>);
        }
      }
    }
  }
} );

    <span class="hljs-comment">/*! ColReorder 1.1.3-dev
 * ©2010-2014 SpryMedia Ltd - datatables.net/license
 */</span>

<span class="hljs-comment">/**
 * @summary     ColReorder
 * @description Provide the ability to reorder columns in a DataTable
 * @version     1.1.3-dev
 * @file        dataTables.colReorder.js
 * @author      SpryMedia Ltd (www.sprymedia.co.uk)
 * @contact     www.sprymedia.co.uk/contact
 * @copyright   Copyright 2010-2014 SpryMedia Ltd.
 *
 * This source file is free software, available under the following license:
 *   MIT license - http://datatables.net/license/mit
 *
 * This source file is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 * or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.
 *
 * For details please refer to: http://www.datatables.net
 */</span>

(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">window, document, undefined</span>) </span>{


<span class="hljs-comment">/**
 * Switch the key value pairing of an index array to be value key (i.e. the old value is now the
 * key). For example consider [ 2, 0, 1 ] this would be returned as [ 1, 2, 0 ].
 *  @method  fnInvertKeyValues
 *  @param   array aIn Array to switch around
 *  @returns array
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fnInvertKeyValues</span>(<span class="hljs-params"> aIn </span>)
</span>{
  <span class="hljs-keyword">var</span> aRet=[];
  <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>, iLen=aIn.length ; i&lt;iLen ; i++ )
  {
    aRet[ aIn[i] ] = i;
  }
  <span class="hljs-keyword">return</span> aRet;
}


<span class="hljs-comment">/**
 * Modify an array by switching the position of two elements
 *  @method  fnArraySwitch
 *  @param   array aArray Array to consider, will be modified by reference (i.e. no return)
 *  @param   int iFrom From point
 *  @param   int iTo Insert point
 *  @returns void
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fnArraySwitch</span>(<span class="hljs-params"> aArray, iFrom, iTo </span>)
</span>{
  <span class="hljs-keyword">var</span> mStore = aArray.splice( iFrom, <span class="hljs-number">1</span> )[<span class="hljs-number">0</span>];
  aArray.splice( iTo, <span class="hljs-number">0</span>, mStore );
}


<span class="hljs-comment">/**
 * Switch the positions of nodes in a parent node (note this is specifically designed for
 * table rows). Note this function considers all element nodes under the parent!
 *  @method  fnDomSwitch
 *  @param   string sTag Tag to consider
 *  @param   int iFrom Element to move
 *  @param   int Point to element the element to (before this point), can be null for append
 *  @returns void
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fnDomSwitch</span>(<span class="hljs-params"> nParent, iFrom, iTo </span>)
</span>{
  <span class="hljs-keyword">var</span> anTags = [];
  <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>, iLen=nParent.childNodes.length ; i&lt;iLen ; i++ )
  {
    <span class="hljs-keyword">if</span> ( nParent.childNodes[i].nodeType == <span class="hljs-number">1</span> )
    {
      anTags.push( nParent.childNodes[i] );
    }
  }
  <span class="hljs-keyword">var</span> nStore = anTags[ iFrom ];

  <span class="hljs-keyword">if</span> ( iTo !== <span class="hljs-literal">null</span> )
  {
    nParent.insertBefore( nStore, anTags[iTo] );
  }
  <span class="hljs-keyword">else</span>
  {
    nParent.appendChild( nStore );
  }
}



<span class="hljs-keyword">var</span> factory = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> $, DataTable </span>) </span>{
<span class="hljs-pi">"use strict"</span>;

<span class="hljs-comment">/**
 * Plug-in for DataTables which will reorder the internal column structure by taking the column
 * from one position (iFrom) and insert it into a given point (iTo).
 *  @method  $.fn.dataTableExt.oApi.fnColReorder
 *  @param   object oSettings DataTables settings object - automatically added by DataTables!
 *  @param   int iFrom Take the column to be repositioned from this point
 *  @param   int iTo and insert it into this point
 *  @returns void
 */</span>
$.fn.dataTableExt.oApi.fnColReorder = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> oSettings, iFrom, iTo </span>)
</span>{
  <span class="hljs-keyword">var</span> v110 = $.fn.dataTable.Api ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">var</span> i, iLen, j, jLen, iCols=oSettings.aoColumns.length, nTrs, oCol;
  <span class="hljs-keyword">var</span> attrMap = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> obj, prop, mapping </span>) </span>{
    <span class="hljs-keyword">if</span> ( ! obj[ prop ] ) {
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">var</span> a = obj[ prop ].split(<span class="hljs-string">'.'</span>);
    <span class="hljs-keyword">var</span> num = a.shift();

    <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">isNaN</span>( num*<span class="hljs-number">1</span> ) ) {
      <span class="hljs-keyword">return</span>;
    }

    obj[ prop ] = mapping[ num*<span class="hljs-number">1</span> ]+<span class="hljs-string">'.'</span>+a.join(<span class="hljs-string">'.'</span>);
  };

  <span class="hljs-comment">/* Sanity check in the input */</span>
  <span class="hljs-keyword">if</span> ( iFrom == iTo )
  {
    <span class="hljs-comment">/* Pointless reorder */</span>
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">if</span> ( iFrom &lt; <span class="hljs-number">0</span> || iFrom &gt;= iCols )
  {
    <span class="hljs-keyword">this</span>.oApi._fnLog( oSettings, <span class="hljs-number">1</span>, <span class="hljs-string">"ColReorder 'from' index is out of bounds: "</span>+iFrom );
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">if</span> ( iTo &lt; <span class="hljs-number">0</span> || iTo &gt;= iCols )
  {
    <span class="hljs-keyword">this</span>.oApi._fnLog( oSettings, <span class="hljs-number">1</span>, <span class="hljs-string">"ColReorder 'to' index is out of bounds: "</span>+iTo );
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">/*
   * Calculate the new column array index, so we have a mapping between the old and new
   */</span>
  <span class="hljs-keyword">var</span> aiMapping = [];
  <span class="hljs-keyword">for</span> ( i=<span class="hljs-number">0</span>, iLen=iCols ; i&lt;iLen ; i++ )
  {
    aiMapping[i] = i;
  }
  fnArraySwitch( aiMapping, iFrom, iTo );
  <span class="hljs-keyword">var</span> aiInvertMapping = fnInvertKeyValues( aiMapping );


  <span class="hljs-comment">/*
   * Convert all internal indexing to the new column order indexes
   */</span>
  <span class="hljs-comment">/* Sorting */</span>
  <span class="hljs-keyword">for</span> ( i=<span class="hljs-number">0</span>, iLen=oSettings.aaSorting.length ; i&lt;iLen ; i++ )
  {
    oSettings.aaSorting[i][<span class="hljs-number">0</span>] = aiInvertMapping[ oSettings.aaSorting[i][<span class="hljs-number">0</span>] ];
  }

  <span class="hljs-comment">/* Fixed sorting */</span>
  <span class="hljs-keyword">if</span> ( oSettings.aaSortingFixed !== <span class="hljs-literal">null</span> )
  {
    <span class="hljs-keyword">for</span> ( i=<span class="hljs-number">0</span>, iLen=oSettings.aaSortingFixed.length ; i&lt;iLen ; i++ )
    {
      oSettings.aaSortingFixed[i][<span class="hljs-number">0</span>] = aiInvertMapping[ oSettings.aaSortingFixed[i][<span class="hljs-number">0</span>] ];
    }
  }

  <span class="hljs-comment">/* Data column sorting (the column which the sort for a given column should take place on) */</span>
  <span class="hljs-keyword">for</span> ( i=<span class="hljs-number">0</span>, iLen=iCols ; i&lt;iLen ; i++ )
  {
    oCol = oSettings.aoColumns[i];
    <span class="hljs-keyword">for</span> ( j=<span class="hljs-number">0</span>, jLen=oCol.aDataSort.length ; j&lt;jLen ; j++ )
    {
      oCol.aDataSort[j] = aiInvertMapping[ oCol.aDataSort[j] ];
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <p>Update the column indexes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ( v110 ) {
      oCol.idx = aiInvertMapping[ oCol.idx ];
    }
  }

  <span class="hljs-keyword">if</span> ( v110 ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <p>Update 1.10 optimised sort class removal variable</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    $.each( oSettings.aLastSort, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">i, val</span>) </span>{
      oSettings.aLastSort[i].src = aiInvertMapping[ val.src ];
    } );
  }

  <span class="hljs-comment">/* Update the Get and Set functions for each column */</span>
  <span class="hljs-keyword">for</span> ( i=<span class="hljs-number">0</span>, iLen=iCols ; i&lt;iLen ; i++ )
  {
    oCol = oSettings.aoColumns[i];

    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> oCol.mData == <span class="hljs-string">'number'</span> ) {
      oCol.mData = aiInvertMapping[ oCol.mData ];</pre></div></div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              <p>regenerate the get / set functions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      oSettings.oApi._fnColumnOptions( oSettings, i, {} );
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( $.isPlainObject( oCol.mData ) ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>HTML5 data sourced</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      attrMap( oCol.mData, <span class="hljs-string">'_'</span>,      aiInvertMapping );
      attrMap( oCol.mData, <span class="hljs-string">'filter'</span>, aiInvertMapping );
      attrMap( oCol.mData, <span class="hljs-string">'sort'</span>,   aiInvertMapping );
      attrMap( oCol.mData, <span class="hljs-string">'type'</span>,   aiInvertMapping );</pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <p>regenerate the get / set functions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      oSettings.oApi._fnColumnOptions( oSettings, i, {} );
    }
  }


  <span class="hljs-comment">/*
   * Move the DOM elements
   */</span>
  <span class="hljs-keyword">if</span> ( oSettings.aoColumns[iFrom].bVisible )
  {
    <span class="hljs-comment">/* Calculate the current visible index and the point to insert the node before. The insert
     * before needs to take into account that there might not be an element to insert before,
     * in which case it will be null, and an appendChild should be used
     */</span>
    <span class="hljs-keyword">var</span> iVisibleIndex = <span class="hljs-keyword">this</span>.oApi._fnColumnIndexToVisible( oSettings, iFrom );
    <span class="hljs-keyword">var</span> iInsertBeforeIndex = <span class="hljs-literal">null</span>;

    i = iTo &lt; iFrom ? iTo : iTo + <span class="hljs-number">1</span>;
    <span class="hljs-keyword">while</span> ( iInsertBeforeIndex === <span class="hljs-literal">null</span> &amp;&amp; i &lt; iCols )
    {
      iInsertBeforeIndex = <span class="hljs-keyword">this</span>.oApi._fnColumnIndexToVisible( oSettings, i );
      i++;
    }

    <span class="hljs-comment">/* Header */</span>
    nTrs = oSettings.nTHead.getElementsByTagName(<span class="hljs-string">'tr'</span>);
    <span class="hljs-keyword">for</span> ( i=<span class="hljs-number">0</span>, iLen=nTrs.length ; i&lt;iLen ; i++ )
    {
      fnDomSwitch( nTrs[i], iVisibleIndex, iInsertBeforeIndex );
    }

    <span class="hljs-comment">/* Footer */</span>
    <span class="hljs-keyword">if</span> ( oSettings.nTFoot !== <span class="hljs-literal">null</span> )
    {
      nTrs = oSettings.nTFoot.getElementsByTagName(<span class="hljs-string">'tr'</span>);
      <span class="hljs-keyword">for</span> ( i=<span class="hljs-number">0</span>, iLen=nTrs.length ; i&lt;iLen ; i++ )
      {
        fnDomSwitch( nTrs[i], iVisibleIndex, iInsertBeforeIndex );
      }
    }

    <span class="hljs-comment">/* Body */</span>
    <span class="hljs-keyword">for</span> ( i=<span class="hljs-number">0</span>, iLen=oSettings.aoData.length ; i&lt;iLen ; i++ )
    {
      <span class="hljs-keyword">if</span> ( oSettings.aoData[i].nTr !== <span class="hljs-literal">null</span> )
      {
        fnDomSwitch( oSettings.aoData[i].nTr, iVisibleIndex, iInsertBeforeIndex );
      }
    }
  }

  <span class="hljs-comment">/*
   * Move the internal array elements
   */</span>
  <span class="hljs-comment">/* Columns */</span>
  fnArraySwitch( oSettings.aoColumns, iFrom, iTo );

  <span class="hljs-comment">/* Search columns */</span>
  fnArraySwitch( oSettings.aoPreSearchCols, iFrom, iTo );

  <span class="hljs-comment">/* Array array - internal data anodes cache */</span>
  <span class="hljs-keyword">for</span> ( i=<span class="hljs-number">0</span>, iLen=oSettings.aoData.length ; i&lt;iLen ; i++ )
  {
    <span class="hljs-keyword">var</span> data = oSettings.aoData[i];

    <span class="hljs-keyword">if</span> ( v110 ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <p>DataTables 1.10+</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> ( data.anCells ) {
        fnArraySwitch( data.anCells, iFrom, iTo );
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <p>For DOM sourced data, the invalidate will reread the cell into
the data array, but for data sources as an array, they need to
be flipped</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> ( data.src !== <span class="hljs-string">'dom'</span> &amp;&amp; $.isArray( data._aData ) ) {
        fnArraySwitch( data._aData, iFrom, iTo );
      }
    }
    <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <p>DataTables 1.9-</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> ( $.isArray( data._aData ) ) {
        fnArraySwitch( data._aData, iFrom, iTo );
      }
      fnArraySwitch( data._anHidden, iFrom, iTo );
    }
  }

  <span class="hljs-comment">/* Reposition the header elements in the header layout array */</span>
  <span class="hljs-keyword">for</span> ( i=<span class="hljs-number">0</span>, iLen=oSettings.aoHeader.length ; i&lt;iLen ; i++ )
  {
    fnArraySwitch( oSettings.aoHeader[i], iFrom, iTo );
  }

  <span class="hljs-keyword">if</span> ( oSettings.aoFooter !== <span class="hljs-literal">null</span> )
  {
    <span class="hljs-keyword">for</span> ( i=<span class="hljs-number">0</span>, iLen=oSettings.aoFooter.length ; i&lt;iLen ; i++ )
    {
      fnArraySwitch( oSettings.aoFooter[i], iFrom, iTo );
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <p>In 1.10 we need to invalidate row cached data for sorting, filtering etc</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> ( v110 ) {
    <span class="hljs-keyword">var</span> api = <span class="hljs-keyword">new</span> $.fn.dataTable.Api( oSettings );
    api.rows().invalidate();
  }

  <span class="hljs-comment">/*
   * Update DataTables' event handlers
   */</span>

  <span class="hljs-comment">/* Sort listener */</span>
  <span class="hljs-keyword">for</span> ( i=<span class="hljs-number">0</span>, iLen=iCols ; i&lt;iLen ; i++ )
  {
    $(oSettings.aoColumns[i].nTh).off(<span class="hljs-string">'click.DT'</span>);
    <span class="hljs-keyword">this</span>.oApi._fnSortAttachListener( oSettings, oSettings.aoColumns[i].nTh, i );
  }


  <span class="hljs-comment">/* Fire an event so other plug-ins can update */</span>
  $(oSettings.oInstance).trigger( <span class="hljs-string">'column-reorder'</span>, [ oSettings, {
    <span class="hljs-string">"iFrom"</span>: iFrom,
    <span class="hljs-string">"iTo"</span>: iTo,
    <span class="hljs-string">"aiInvertMapping"</span>: aiInvertMapping
  } ] );
};


<span class="hljs-comment">/**
 * ColReorder provides column visibility control for DataTables
 * @class ColReorder
 * @constructor
 * @param {object} dt DataTables settings object
 * @param {object} opts ColReorder options
 */</span>
<span class="hljs-keyword">var</span> ColReorder = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> dt, opts </span>)
</span>{
  <span class="hljs-keyword">var</span> oDTSettings;

  <span class="hljs-keyword">if</span> ( $.fn.dataTable.Api ) {
    oDTSettings = <span class="hljs-keyword">new</span> $.fn.dataTable.Api( dt ).settings()[<span class="hljs-number">0</span>];
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              <p>1.9 compatibility</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( dt.fnSettings ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <p>DataTables object, convert to the settings object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    oDTSettings = dt.fnSettings();
  }
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> dt === <span class="hljs-string">'string'</span> ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              <p>jQuery selector</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ( $.fn.dataTable.fnIsDataTable( $(dt)[<span class="hljs-number">0</span>] ) ) {
      oDTSettings = $(dt).eq(<span class="hljs-number">0</span>).dataTable().fnSettings();
    }
  }
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( dt.nodeName &amp;&amp; dt.nodeName.toLowerCase() === <span class="hljs-string">'table'</span> ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <p>Table node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ( $.fn.dataTable.fnIsDataTable( dt.nodeName ) ) {
      oDTSettings = $(dt.nodeName).dataTable().fnSettings();
    }
  }
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( dt <span class="hljs-keyword">instanceof</span> jQuery ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              <p>jQuery object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ( $.fn.dataTable.fnIsDataTable( dt[<span class="hljs-number">0</span>] ) ) {
      oDTSettings = dt.eq(<span class="hljs-number">0</span>).dataTable().fnSettings();
    }
  }
  <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <p>DataTables settings object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    oDTSettings = dt;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              <p>Ensure that we can’t initialise on the same table twice</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> ( oDTSettings._colReorder ) {
    <span class="hljs-keyword">throw</span> <span class="hljs-string">"ColReorder already initialised on table #"</span>+oDTSettings.nTable.id;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-121">&#182;</a>
              </div>
              <p>Convert from camelCase to Hungarian, just as DataTables does</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> camelToHungarian = $.fn.dataTable.camelToHungarian;
  <span class="hljs-keyword">if</span> ( camelToHungarian ) {
    camelToHungarian( ColReorder.defaults, ColReorder.defaults, <span class="hljs-literal">true</span> );
    camelToHungarian( ColReorder.defaults, opts || {} );
  }


  <span class="hljs-comment">/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
   * Public class variables
   * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */</span>

  <span class="hljs-comment">/**
   * @namespace Settings object which contains customisable information for ColReorder instance
   */</span>
  <span class="hljs-keyword">this</span>.s = {
    <span class="hljs-comment">/**
     * DataTables settings object
     *  @property dt
     *  @type     Object
     *  @default  null
     */</span>
    <span class="hljs-string">"dt"</span>: <span class="hljs-literal">null</span>,

    <span class="hljs-comment">/**
     * Initialisation object used for this instance
     *  @property init
     *  @type     object
     *  @default  {}
     */</span>
    <span class="hljs-string">"init"</span>: $.extend( <span class="hljs-literal">true</span>, {}, ColReorder.defaults, opts ),

    <span class="hljs-comment">/**
     * Number of columns to fix (not allow to be reordered)
     *  @property fixed
     *  @type     int
     *  @default  0
     */</span>
    <span class="hljs-string">"fixed"</span>: <span class="hljs-number">0</span>,

    <span class="hljs-comment">/**
     * Number of columns to fix counting from right (not allow to be reordered)
     *  @property fixedRight
     *  @type     int
     *  @default  0
     */</span>
    <span class="hljs-string">"fixedRight"</span>: <span class="hljs-number">0</span>,

    <span class="hljs-comment">/**
     * Callback function for once the reorder has been done
     *  @property dropcallback
     *  @type     function
     *  @default  null
     */</span>
    <span class="hljs-string">"dropCallback"</span>: <span class="hljs-literal">null</span>,

    <span class="hljs-comment">/**
     * @namespace Information used for the mouse drag
     */</span>
    <span class="hljs-string">"mouse"</span>: {
      <span class="hljs-string">"startX"</span>: -<span class="hljs-number">1</span>,
      <span class="hljs-string">"startY"</span>: -<span class="hljs-number">1</span>,
      <span class="hljs-string">"offsetX"</span>: -<span class="hljs-number">1</span>,
      <span class="hljs-string">"offsetY"</span>: -<span class="hljs-number">1</span>,
      <span class="hljs-string">"target"</span>: -<span class="hljs-number">1</span>,
      <span class="hljs-string">"targetIndex"</span>: -<span class="hljs-number">1</span>,
      <span class="hljs-string">"fromIndex"</span>: -<span class="hljs-number">1</span>
    },

    <span class="hljs-comment">/**
     * Information which is used for positioning the insert cusor and knowing where to do the
     * insert. Array of objects with the properties:
     *   x: x-axis position
     *   to: insert point
     *  @property aoTargets
     *  @type     array
     *  @default  []
     */</span>
    <span class="hljs-string">"aoTargets"</span>: []
  };


  <span class="hljs-comment">/**
   * @namespace Common and useful DOM elements for the class instance
   */</span>
  <span class="hljs-keyword">this</span>.dom = {
    <span class="hljs-comment">/**
     * Dragging element (the one the mouse is moving)
     *  @property drag
     *  @type     element
     *  @default  null
     */</span>
    <span class="hljs-string">"drag"</span>: <span class="hljs-literal">null</span>,

    <span class="hljs-comment">/**
     * The insert cursor
     *  @property pointer
     *  @type     element
     *  @default  null
     */</span>
    <span class="hljs-string">"pointer"</span>: <span class="hljs-literal">null</span>
  };


  <span class="hljs-comment">/* Constructor logic */</span>
  <span class="hljs-keyword">this</span>.s.dt = oDTSettings;
  <span class="hljs-keyword">this</span>.s.dt._colReorder = <span class="hljs-keyword">this</span>;
  <span class="hljs-keyword">this</span>._fnConstruct();

  <span class="hljs-comment">/* Add destroy callback */</span>
  oDTSettings.oApi._fnCallbackReg(oDTSettings, <span class="hljs-string">'aoDestroyCallback'</span>, $.proxy(<span class="hljs-keyword">this</span>._fnDestroy, <span class="hljs-keyword">this</span>), <span class="hljs-string">'ColReorder'</span>);

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};



ColReorder.prototype = {
  <span class="hljs-comment">/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
   * Public methods
   * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */</span>

  <span class="hljs-comment">/**
   * Reset the column ordering to the original ordering that was detected on
   * start up.
   *  @return {this} Returns `this` for chaining.
   *
   *  @example
   *    // DataTables initialisation with ColReorder
   *    var table = $('#example').dataTable( {
   *        "sDom": 'Rlfrtip'
   *    } );
   *
   *    // Add click event to a button to reset the ordering
   *    $('#resetOrdering').click( function (e) {
   *        e.preventDefault();
   *        $.fn.dataTable.ColReorder( table ).fnReset();
   *    } );
   */</span>
  <span class="hljs-string">"fnReset"</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)
  </span>{
    <span class="hljs-keyword">var</span> a = [];
    <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>, iLen=<span class="hljs-keyword">this</span>.s.dt.aoColumns.length ; i&lt;iLen ; i++ )
    {
      a.push( <span class="hljs-keyword">this</span>.s.dt.aoColumns[i]._ColReorder_iOrigCol );
    }

    <span class="hljs-keyword">this</span>._fnOrderColumns( a );

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  },

  <span class="hljs-comment">/**
   * `Deprecated` - Get the current order of the columns, as an array.
   *  @return {array} Array of column identifiers
   *  @deprecated `fnOrder` should be used in preference to this method.
   *      `fnOrder` acts as a getter/setter.
   */</span>
  <span class="hljs-string">"fnGetCurrentOrder"</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)
  </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.fnOrder();
  },

  <span class="hljs-comment">/**
   * Get the current order of the columns, as an array. Note that the values
   * given in the array are unique identifiers for each column. Currently
   * these are the original ordering of the columns that was detected on
   * start up, but this could potentially change in future.
   *  @return {array} Array of column identifiers
   *
   *  @example
   *    // Get column ordering for the table
   *    var order = $.fn.dataTable.ColReorder( dataTable ).fnOrder();
   */</span><span class="hljs-comment">/**
   * Set the order of the columns, from the positions identified in the
   * ordering array given. Note that ColReorder takes a brute force approach
   * to reordering, so it is possible multiple reordering events will occur
   * before the final order is settled upon.
   *  @param {array} [set] Array of column identifiers in the new order. Note
   *    that every column must be included, uniquely, in this array.
   *  @return {this} Returns `this` for chaining.
   *
   *  @example
   *    // Swap the first and second columns
   *    $.fn.dataTable.ColReorder( dataTable ).fnOrder( [1, 0, 2, 3, 4] );
   *
   *  @example
   *    // Move the first column to the end for the table `#example`
   *    var curr = $.fn.dataTable.ColReorder( '#example' ).fnOrder();
   *    var first = curr.shift();
   *    curr.push( first );
   *    $.fn.dataTable.ColReorder( '#example' ).fnOrder( curr );
   *
   *  @example
   *    // Reverse the table's order
   *    $.fn.dataTable.ColReorder( '#example' ).fnOrder(
   *      $.fn.dataTable.ColReorder( '#example' ).fnOrder().reverse()
   *    );
   */</span>
  <span class="hljs-string">"fnOrder"</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> set </span>)
  </span>{
    <span class="hljs-keyword">if</span> ( set === <span class="hljs-literal">undefined</span> )
    {
      <span class="hljs-keyword">var</span> a = [];
      <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>, iLen=<span class="hljs-keyword">this</span>.s.dt.aoColumns.length ; i&lt;iLen ; i++ )
      {
        a.push( <span class="hljs-keyword">this</span>.s.dt.aoColumns[i]._ColReorder_iOrigCol );
      }
      <span class="hljs-keyword">return</span> a;
    }

    <span class="hljs-keyword">this</span>._fnOrderColumns( fnInvertKeyValues( set ) );

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  },


  <span class="hljs-comment">/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
   * Private methods (they are of course public in JS, but recommended as private)
   * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */</span>

  <span class="hljs-comment">/**
   * Constructor logic
   *  @method  _fnConstruct
   *  @returns void
   *  @private
   */</span>
  <span class="hljs-string">"_fnConstruct"</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)
  </span>{
    <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">var</span> iLen = <span class="hljs-keyword">this</span>.s.dt.aoColumns.length;
    <span class="hljs-keyword">var</span> i;

    <span class="hljs-comment">/* Columns discounted from reordering - counting left to right */</span>
    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.s.init.iFixedColumns )
    {
      <span class="hljs-keyword">this</span>.s.fixed = <span class="hljs-keyword">this</span>.s.init.iFixedColumns;
    }

    <span class="hljs-comment">/* Columns discounted from reordering - counting right to left */</span>
    <span class="hljs-keyword">this</span>.s.fixedRight = <span class="hljs-keyword">this</span>.s.init.iFixedColumnsRight ?
      <span class="hljs-keyword">this</span>.s.init.iFixedColumnsRight :
      <span class="hljs-number">0</span>;

    <span class="hljs-comment">/* Drop callback initialisation option */</span>
    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.s.init.fnReorderCallback )
    {
      <span class="hljs-keyword">this</span>.s.dropCallback = <span class="hljs-keyword">this</span>.s.init.fnReorderCallback;
    }

    <span class="hljs-comment">/* Add event handlers for the drag and drop, and also mark the original column order */</span>
    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; iLen; i++ )
    {
      <span class="hljs-keyword">if</span> ( i &gt; <span class="hljs-keyword">this</span>.s.fixed-<span class="hljs-number">1</span> &amp;&amp; i &lt; iLen - <span class="hljs-keyword">this</span>.s.fixedRight )
      {
        <span class="hljs-keyword">this</span>._fnMouseListener( i, <span class="hljs-keyword">this</span>.s.dt.aoColumns[i].nTh );
      }

      <span class="hljs-comment">/* Mark the original column order for later reference */</span>
      <span class="hljs-keyword">this</span>.s.dt.aoColumns[i]._ColReorder_iOrigCol = i;
    }

    <span class="hljs-comment">/* State saving */</span>
    <span class="hljs-keyword">this</span>.s.dt.oApi._fnCallbackReg( <span class="hljs-keyword">this</span>.s.dt, <span class="hljs-string">'aoStateSaveParams'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">oS, oData</span>) </span>{
      that._fnStateSave.call( that, oData );
    }, <span class="hljs-string">"ColReorder_State"</span> );

    <span class="hljs-comment">/* An initial column order has been specified */</span>
    <span class="hljs-keyword">var</span> aiOrder = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.s.init.aiOrder )
    {
      aiOrder = <span class="hljs-keyword">this</span>.s.init.aiOrder.slice();
    }

    <span class="hljs-comment">/* State loading, overrides the column order given */</span>
    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.s.dt.oLoadedState &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>.s.dt.oLoadedState.ColReorder != <span class="hljs-string">'undefined'</span> &amp;&amp;
      <span class="hljs-keyword">this</span>.s.dt.oLoadedState.ColReorder.length == <span class="hljs-keyword">this</span>.s.dt.aoColumns.length )
    {
      aiOrder = <span class="hljs-keyword">this</span>.s.dt.oLoadedState.ColReorder;
    }

    <span class="hljs-comment">/* If we have an order to apply - do so */</span>
    <span class="hljs-keyword">if</span> ( aiOrder )
    {
      <span class="hljs-comment">/* We might be called during or after the DataTables initialisation. If before, then we need
       * to wait until the draw is done, if after, then do what we need to do right away
       */</span>
      <span class="hljs-keyword">if</span> ( !that.s.dt._bInitComplete )
      {
        <span class="hljs-keyword">var</span> bDone = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">this</span>.s.dt.aoDrawCallback.push( {
          <span class="hljs-string">"fn"</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> ( !that.s.dt._bInitComplete &amp;&amp; !bDone )
            {
              bDone = <span class="hljs-literal">true</span>;
              <span class="hljs-keyword">var</span> resort = fnInvertKeyValues( aiOrder );
              that._fnOrderColumns.call( that, resort );
            }
          },
          <span class="hljs-string">"sName"</span>: <span class="hljs-string">"ColReorder_Pre"</span>
        } );
      }
      <span class="hljs-keyword">else</span>
      {
        <span class="hljs-keyword">var</span> resort = fnInvertKeyValues( aiOrder );
        that._fnOrderColumns.call( that, resort );
      }
    }
    <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">this</span>._fnSetColumnIndexes();
    }
  },


  <span class="hljs-comment">/**
   * Set the column order from an array
   *  @method  _fnOrderColumns
   *  @param   array a An array of integers which dictate the column order that should be applied
   *  @returns void
   *  @private
   */</span>
  <span class="hljs-string">"_fnOrderColumns"</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> a </span>)
  </span>{
    <span class="hljs-keyword">if</span> ( a.length != <span class="hljs-keyword">this</span>.s.dt.aoColumns.length )
    {
      <span class="hljs-keyword">this</span>.s.dt.oInstance.oApi._fnLog( <span class="hljs-keyword">this</span>.s.dt, <span class="hljs-number">1</span>, <span class="hljs-string">"ColReorder - array reorder does not "</span>+
        <span class="hljs-string">"match known number of columns. Skipping."</span> );
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>, iLen=a.length ; i&lt;iLen ; i++ )
    {
      <span class="hljs-keyword">var</span> currIndex = $.inArray( i, a );
      <span class="hljs-keyword">if</span> ( i != currIndex )
      {
        <span class="hljs-comment">/* Reorder our switching array */</span>
        fnArraySwitch( a, currIndex, i );

        <span class="hljs-comment">/* Do the column reorder in the table */</span>
        <span class="hljs-keyword">this</span>.s.dt.oInstance.fnColReorder( currIndex, i );
      }
    }

    <span class="hljs-comment">/* When scrolling we need to recalculate the column sizes to allow for the shift */</span>
    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.s.dt.oScroll.sX !== <span class="hljs-string">""</span> || <span class="hljs-keyword">this</span>.s.dt.oScroll.sY !== <span class="hljs-string">""</span> )
    {
      <span class="hljs-keyword">this</span>.s.dt.oInstance.fnAdjustColumnSizing();
    }

    <span class="hljs-comment">/* Save the state */</span>
    <span class="hljs-keyword">this</span>.s.dt.oInstance.oApi._fnSaveState( <span class="hljs-keyword">this</span>.s.dt );

    <span class="hljs-keyword">this</span>._fnSetColumnIndexes();
  },


  <span class="hljs-comment">/**
   * Because we change the indexes of columns in the table, relative to their starting point
   * we need to reorder the state columns to what they are at the starting point so we can
   * then rearrange them again on state load!
   *  @method  _fnStateSave
   *  @param   object oState DataTables state
   *  @returns string JSON encoded cookie string for DataTables
   *  @private
   */</span>
  <span class="hljs-string">"_fnStateSave"</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> oState </span>)
  </span>{
    <span class="hljs-keyword">var</span> i, iLen, aCopy, iOrigColumn;
    <span class="hljs-keyword">var</span> oSettings = <span class="hljs-keyword">this</span>.s.dt;
    <span class="hljs-keyword">var</span> columns = oSettings.aoColumns;

    oState.ColReorder = [];

    <span class="hljs-comment">/* Sorting */</span>
    <span class="hljs-keyword">if</span> ( oState.aaSorting ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-122">&#182;</a>
              </div>
              <p>1.10.0-</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">for</span> ( i=<span class="hljs-number">0</span> ; i&lt;oState.aaSorting.length ; i++ ) {
        oState.aaSorting[i][<span class="hljs-number">0</span>] = columns[ oState.aaSorting[i][<span class="hljs-number">0</span>] ]._ColReorder_iOrigCol;
      }

      <span class="hljs-keyword">var</span> aSearchCopy = $.extend( <span class="hljs-literal">true</span>, [], oState.aoSearchCols );

      <span class="hljs-keyword">for</span> ( i=<span class="hljs-number">0</span>, iLen=columns.length ; i&lt;iLen ; i++ )
      {
        iOrigColumn = columns[i]._ColReorder_iOrigCol;

        <span class="hljs-comment">/* Column filter */</span>
        oState.aoSearchCols[ iOrigColumn ] = aSearchCopy[i];

        <span class="hljs-comment">/* Visibility */</span>
        oState.abVisCols[ iOrigColumn ] = columns[i].bVisible;

        <span class="hljs-comment">/* Column reordering */</span>
        oState.ColReorder.push( iOrigColumn );
      }
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( oState.order ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-123">&#182;</a>
              </div>
              <p>1.10.1+</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">for</span> ( i=<span class="hljs-number">0</span> ; i&lt;oState.order.length ; i++ ) {
        oState.order[i][<span class="hljs-number">0</span>] = columns[ oState.order[i][<span class="hljs-number">0</span>] ]._ColReorder_iOrigCol;
      }

      <span class="hljs-keyword">var</span> stateColumnsCopy = $.extend( <span class="hljs-literal">true</span>, [], oState.columns );

      <span class="hljs-keyword">for</span> ( i=<span class="hljs-number">0</span>, iLen=columns.length ; i&lt;iLen ; i++ )
      {
        iOrigColumn = columns[i]._ColReorder_iOrigCol;

        <span class="hljs-comment">/* Columns */</span>
        oState.columns[ iOrigColumn ] = stateColumnsCopy[i];

        <span class="hljs-comment">/* Column reordering */</span>
        oState.ColReorder.push( iOrigColumn );
      }
    }
  },


  <span class="hljs-comment">/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
   * Mouse drop and drag
   */</span>

  <span class="hljs-comment">/**
   * Add a mouse down listener to a particluar TH element
   *  @method  _fnMouseListener
   *  @param   int i Column index
   *  @param   element nTh TH element clicked on
   *  @returns void
   *  @private
   */</span>
  <span class="hljs-string">"_fnMouseListener"</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> i, nTh </span>)
  </span>{
    <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
    $(nTh).on( <span class="hljs-string">'mousedown.ColReorder'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
      e.preventDefault();
      that._fnMouseDown.call( that, e, nTh );
    } );
  },


  <span class="hljs-comment">/**
   * Mouse down on a TH element in the table header
   *  @method  _fnMouseDown
   *  @param   event e Mouse event
   *  @param   element nTh TH element to be dragged
   *  @returns void
   *  @private
   */</span>
  <span class="hljs-string">"_fnMouseDown"</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> e, nTh </span>)
  </span>{
    <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;

    <span class="hljs-comment">/* Store information about the mouse position */</span>
    <span class="hljs-keyword">var</span> target = $(e.target).closest(<span class="hljs-string">'th, td'</span>);
    <span class="hljs-keyword">var</span> offset = target.offset();
    <span class="hljs-keyword">var</span> idx = <span class="hljs-built_in">parseInt</span>( $(nTh).attr(<span class="hljs-string">'data-column-index'</span>), <span class="hljs-number">10</span> );

    <span class="hljs-keyword">if</span> ( idx === <span class="hljs-literal">undefined</span> ) {
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">this</span>.s.mouse.startX = e.pageX;
    <span class="hljs-keyword">this</span>.s.mouse.startY = e.pageY;
    <span class="hljs-keyword">this</span>.s.mouse.offsetX = e.pageX - offset.left;
    <span class="hljs-keyword">this</span>.s.mouse.offsetY = e.pageY - offset.top;
    <span class="hljs-keyword">this</span>.s.mouse.target = <span class="hljs-keyword">this</span>.s.dt.aoColumns[ idx ].nTh;<span class="hljs-comment">//target[0];</span>
    <span class="hljs-keyword">this</span>.s.mouse.targetIndex = idx;
    <span class="hljs-keyword">this</span>.s.mouse.fromIndex = idx;

    <span class="hljs-keyword">this</span>._fnRegions();

    <span class="hljs-comment">/* Add event handlers to the document */</span>
    $(<span class="hljs-built_in">document</span>)
      .on( <span class="hljs-string">'mousemove.ColReorder'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
        that._fnMouseMove.call( that, e );
      } )
      .on( <span class="hljs-string">'mouseup.ColReorder'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
        that._fnMouseUp.call( that, e );
      } );
  },


  <span class="hljs-comment">/**
   * Deal with a mouse move event while dragging a node
   *  @method  _fnMouseMove
   *  @param   event e Mouse event
   *  @returns void
   *  @private
   */</span>
  <span class="hljs-string">"_fnMouseMove"</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> e </span>)
  </span>{
    <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.dom.drag === <span class="hljs-literal">null</span> )
    {
      <span class="hljs-comment">/* Only create the drag element if the mouse has moved a specific distance from the start
       * point - this allows the user to make small mouse movements when sorting and not have a
       * possibly confusing drag element showing up
       */</span>
      <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">Math</span>.pow(
        <span class="hljs-built_in">Math</span>.pow(e.pageX - <span class="hljs-keyword">this</span>.s.mouse.startX, <span class="hljs-number">2</span>) +
        <span class="hljs-built_in">Math</span>.pow(e.pageY - <span class="hljs-keyword">this</span>.s.mouse.startY, <span class="hljs-number">2</span>), <span class="hljs-number">0.5</span> ) &lt; <span class="hljs-number">5</span> )
      {
        <span class="hljs-keyword">return</span>;
      }
      <span class="hljs-keyword">this</span>._fnCreateDragNode();
    }

    <span class="hljs-comment">/* Position the element - we respect where in the element the click occured */</span>
    <span class="hljs-keyword">this</span>.dom.drag.css( {
      left: e.pageX - <span class="hljs-keyword">this</span>.s.mouse.offsetX,
      top: e.pageY - <span class="hljs-keyword">this</span>.s.mouse.offsetY
    } );

    <span class="hljs-comment">/* Based on the current mouse position, calculate where the insert should go */</span>
    <span class="hljs-keyword">var</span> bSet = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">var</span> lastToIndex = <span class="hljs-keyword">this</span>.s.mouse.toIndex;

    <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i=<span class="hljs-number">1</span>, iLen=<span class="hljs-keyword">this</span>.s.aoTargets.length ; i&lt;iLen ; i++ )
    {
      <span class="hljs-keyword">if</span> ( e.pageX &lt; <span class="hljs-keyword">this</span>.s.aoTargets[i-<span class="hljs-number">1</span>].x + ((<span class="hljs-keyword">this</span>.s.aoTargets[i].x-<span class="hljs-keyword">this</span>.s.aoTargets[i-<span class="hljs-number">1</span>].x)/<span class="hljs-number">2</span>) )
      {
        <span class="hljs-keyword">this</span>.dom.pointer.css( <span class="hljs-string">'left'</span>, <span class="hljs-keyword">this</span>.s.aoTargets[i-<span class="hljs-number">1</span>].x );
        <span class="hljs-keyword">this</span>.s.mouse.toIndex = <span class="hljs-keyword">this</span>.s.aoTargets[i-<span class="hljs-number">1</span>].to;
        bSet = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">break</span>;
      }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-124">&#182;</a>
              </div>
              <p>The insert element wasn’t positioned in the array (less than
operator), so we put it at the end</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ( !bSet )
    {
      <span class="hljs-keyword">this</span>.dom.pointer.css( <span class="hljs-string">'left'</span>, <span class="hljs-keyword">this</span>.s.aoTargets[<span class="hljs-keyword">this</span>.s.aoTargets.length-<span class="hljs-number">1</span>].x );
      <span class="hljs-keyword">this</span>.s.mouse.toIndex = <span class="hljs-keyword">this</span>.s.aoTargets[<span class="hljs-keyword">this</span>.s.aoTargets.length-<span class="hljs-number">1</span>].to;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-125">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-125">&#182;</a>
              </div>
              <p>Perform reordering if realtime updating is on and the column has moved</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.s.init.bRealtime &amp;&amp; lastToIndex !== <span class="hljs-keyword">this</span>.s.mouse.toIndex ) {
      <span class="hljs-keyword">this</span>.s.dt.oInstance.fnColReorder( <span class="hljs-keyword">this</span>.s.mouse.fromIndex, <span class="hljs-keyword">this</span>.s.mouse.toIndex );
      <span class="hljs-keyword">this</span>.s.mouse.fromIndex = <span class="hljs-keyword">this</span>.s.mouse.toIndex;
      <span class="hljs-keyword">this</span>._fnRegions();
    }
  },


  <span class="hljs-comment">/**
   * Finish off the mouse drag and insert the column where needed
   *  @method  _fnMouseUp
   *  @param   event e Mouse event
   *  @returns void
   *  @private
   */</span>
  <span class="hljs-string">"_fnMouseUp"</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> e </span>)
  </span>{
    <span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;

    $(<span class="hljs-built_in">document</span>).off( <span class="hljs-string">'mousemove.ColReorder mouseup.ColReorder'</span> );

    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.dom.drag !== <span class="hljs-literal">null</span> )
    {
      <span class="hljs-comment">/* Remove the guide elements */</span>
      <span class="hljs-keyword">this</span>.dom.drag.remove();
      <span class="hljs-keyword">this</span>.dom.pointer.remove();
      <span class="hljs-keyword">this</span>.dom.drag = <span class="hljs-literal">null</span>;
      <span class="hljs-keyword">this</span>.dom.pointer = <span class="hljs-literal">null</span>;

      <span class="hljs-comment">/* Actually do the reorder */</span>
      <span class="hljs-keyword">this</span>.s.dt.oInstance.fnColReorder( <span class="hljs-keyword">this</span>.s.mouse.fromIndex, <span class="hljs-keyword">this</span>.s.mouse.toIndex );
      <span class="hljs-keyword">this</span>._fnSetColumnIndexes();

      <span class="hljs-comment">/* When scrolling we need to recalculate the column sizes to allow for the shift */</span>
      <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.s.dt.oScroll.sX !== <span class="hljs-string">""</span> || <span class="hljs-keyword">this</span>.s.dt.oScroll.sY !== <span class="hljs-string">""</span> )
      {
        <span class="hljs-keyword">this</span>.s.dt.oInstance.fnAdjustColumnSizing();
      }

      <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.s.dropCallback !== <span class="hljs-literal">null</span> )
      {
        <span class="hljs-keyword">this</span>.s.dropCallback.call( <span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>.s.mouse.fromIndex, <span class="hljs-keyword">this</span>.s.mouse.toIndex );
      }

      <span class="hljs-comment">/* Save the state */</span>
      <span class="hljs-keyword">this</span>.s.dt.oInstance.oApi._fnSaveState( <span class="hljs-keyword">this</span>.s.dt );
    }
  },


  <span class="hljs-comment">/**
   * Calculate a cached array with the points of the column inserts, and the
   * 'to' points
   *  @method  _fnRegions
   *  @returns void
   *  @private
   */</span>
  <span class="hljs-string">"_fnRegions"</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)
  </span>{
    <span class="hljs-keyword">var</span> aoColumns = <span class="hljs-keyword">this</span>.s.dt.aoColumns;

    <span class="hljs-keyword">this</span>.s.aoTargets.splice( <span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.s.aoTargets.length );

    <span class="hljs-keyword">this</span>.s.aoTargets.push( {
      <span class="hljs-string">"x"</span>:  $(<span class="hljs-keyword">this</span>.s.dt.nTable).offset().left,
      <span class="hljs-string">"to"</span>: <span class="hljs-number">0</span>
    } );

    <span class="hljs-keyword">var</span> iToPoint = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>, iLen=aoColumns.length ; i&lt;iLen ; i++ )
    {
      <span class="hljs-comment">/* For the column / header in question, we want it's position to remain the same if the
       * position is just to it's immediate left or right, so we only incremement the counter for
       * other columns
       */</span>
      <span class="hljs-keyword">if</span> ( i != <span class="hljs-keyword">this</span>.s.mouse.fromIndex )
      {
        iToPoint++;
      }

      <span class="hljs-keyword">if</span> ( aoColumns[i].bVisible )
      {
        <span class="hljs-keyword">this</span>.s.aoTargets.push( {
          <span class="hljs-string">"x"</span>:  $(aoColumns[i].nTh).offset().left + $(aoColumns[i].nTh).outerWidth(),
          <span class="hljs-string">"to"</span>: iToPoint
        } );
      }
    }

    <span class="hljs-comment">/* Disallow columns for being reordered by drag and drop, counting right to left */</span>
    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.s.fixedRight !== <span class="hljs-number">0</span> )
    {
      <span class="hljs-keyword">this</span>.s.aoTargets.splice( <span class="hljs-keyword">this</span>.s.aoTargets.length - <span class="hljs-keyword">this</span>.s.fixedRight );
    }

    <span class="hljs-comment">/* Disallow columns for being reordered by drag and drop, counting left to right */</span>
    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.s.fixed !== <span class="hljs-number">0</span> )
    {
      <span class="hljs-keyword">this</span>.s.aoTargets.splice( <span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.s.fixed );
    }
  },


  <span class="hljs-comment">/**
   * Copy the TH element that is being drags so the user has the idea that they are actually
   * moving it around the page.
   *  @method  _fnCreateDragNode
   *  @returns void
   *  @private
   */</span>
  <span class="hljs-string">"_fnCreateDragNode"</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)
  </span>{
    <span class="hljs-keyword">var</span> scrolling = <span class="hljs-keyword">this</span>.s.dt.oScroll.sX !== <span class="hljs-string">""</span> || <span class="hljs-keyword">this</span>.s.dt.oScroll.sY !== <span class="hljs-string">""</span>;

    <span class="hljs-keyword">var</span> origCell = <span class="hljs-keyword">this</span>.s.dt.aoColumns[ <span class="hljs-keyword">this</span>.s.mouse.targetIndex ].nTh;
    <span class="hljs-keyword">var</span> origTr = origCell.parentNode;
    <span class="hljs-keyword">var</span> origThead = origTr.parentNode;
    <span class="hljs-keyword">var</span> origTable = origThead.parentNode;
    <span class="hljs-keyword">var</span> cloneCell = $(origCell).clone();</pre></div></div>
            
        </li>
        
        
        <li id="section-126">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-126">&#182;</a>
              </div>
              <p>This is a slightly odd combination of jQuery and DOM, but it is the
fastest and least resource intensive way I could think of cloning
the table with just a single header cell in it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.dom.drag = $(origTable.cloneNode(<span class="hljs-literal">false</span>))
      .addClass( <span class="hljs-string">'DTCR_clonedTable'</span> )
      .append(
        origThead.cloneNode(<span class="hljs-literal">false</span>).appendChild(
          origTr.cloneNode(<span class="hljs-literal">false</span>).appendChild(
            cloneCell[<span class="hljs-number">0</span>]
          )
        )
      )
      .css( {
        position: <span class="hljs-string">'absolute'</span>,
        top: <span class="hljs-number">0</span>,
        left: <span class="hljs-number">0</span>,
        width: $(origCell).outerWidth(),
        height: $(origCell).outerHeight()
      } )
      .appendTo( <span class="hljs-string">'body'</span> );

    <span class="hljs-keyword">this</span>.dom.pointer = $(<span class="hljs-string">'&lt;div&gt;&lt;/div&gt;'</span>)
      .addClass( <span class="hljs-string">'DTCR_pointer'</span> )
      .css( {
        position: <span class="hljs-string">'absolute'</span>,
        top: scrolling ?
          $(<span class="hljs-string">'div.dataTables_scroll'</span>, <span class="hljs-keyword">this</span>.s.dt.nTableWrapper).offset().top :
          $(<span class="hljs-keyword">this</span>.s.dt.nTable).offset().top,
        height : scrolling ?
          $(<span class="hljs-string">'div.dataTables_scroll'</span>, <span class="hljs-keyword">this</span>.s.dt.nTableWrapper).height() :
          $(<span class="hljs-keyword">this</span>.s.dt.nTable).height()
      } )
      .appendTo( <span class="hljs-string">'body'</span> );
  },

  <span class="hljs-comment">/**
   * Clean up ColReorder memory references and event handlers
   *  @method  _fnDestroy
   *  @returns void
   *  @private
   */</span>
  <span class="hljs-string">"_fnDestroy"</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)
  </span>{
    <span class="hljs-keyword">var</span> i, iLen;

    <span class="hljs-keyword">for</span> ( i=<span class="hljs-number">0</span>, iLen=<span class="hljs-keyword">this</span>.s.dt.aoDrawCallback.length ; i&lt;iLen ; i++ )
    {
      <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.s.dt.aoDrawCallback[i].sName === <span class="hljs-string">'ColReorder_Pre'</span> )
      {
        <span class="hljs-keyword">this</span>.s.dt.aoDrawCallback.splice( i, <span class="hljs-number">1</span> );
        <span class="hljs-keyword">break</span>;
      }
    }

    $(<span class="hljs-keyword">this</span>.s.dt.nTHead).find( <span class="hljs-string">'*'</span> ).off( <span class="hljs-string">'.ColReorder'</span> );

    $.each( <span class="hljs-keyword">this</span>.s.dt.aoColumns, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">i, column</span>) </span>{
      $(column.nTh).removeAttr(<span class="hljs-string">'data-column-index'</span>);
    } );

    <span class="hljs-keyword">this</span>.s.dt._colReorder = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.s = <span class="hljs-literal">null</span>;
  },


  <span class="hljs-comment">/**
   * Add a data attribute to the column headers, so we know the index of
   * the row to be reordered. This allows fast detection of the index, and
   * for this plug-in to work with FixedHeader which clones the nodes.
   *  @private
   */</span>
  <span class="hljs-string">"_fnSetColumnIndexes"</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)
  </span>{
    $.each( <span class="hljs-keyword">this</span>.s.dt.aoColumns, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">i, column</span>) </span>{
      $(column.nTh).attr(<span class="hljs-string">'data-column-index'</span>, i);
    } );
  }
};





<span class="hljs-comment">/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 * Static parameters
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */</span>


<span class="hljs-comment">/**
 * ColReorder default settings for initialisation
 *  @namespace
 *  @static
 */</span>
ColReorder.defaults = {
  <span class="hljs-comment">/**
   * Predefined ordering for the columns that will be applied automatically
   * on initialisation. If not specified then the order that the columns are
   * found to be in the HTML is the order used.
   *  @type array
   *  @default null
   *  @static
   *  @example
   *      // Using the `oColReorder` option in the DataTables options object
   *      $('#example').dataTable( {
   *          "sDom": 'Rlfrtip',
   *          "oColReorder": {
   *              "aiOrder": [ 4, 3, 2, 1, 0 ]
   *          }
   *      } );
   *
   *  @example
   *      // Using `new` constructor
   *      $('#example').dataTable()
   *
   *      new $.fn.dataTable.ColReorder( '#example', {
   *          "aiOrder": [ 4, 3, 2, 1, 0 ]
   *      } );
   */</span>
  aiOrder: <span class="hljs-literal">null</span>,

  <span class="hljs-comment">/**
   * Redraw the table's column ordering as the end user draws the column
   * (`true`) or wait until the mouse is released (`false` - default). Note
   * that this will perform a redraw on each reordering, which involves an
   * Ajax request each time if you are using server-side processing in
   * DataTables.
   *  @type boolean
   *  @default false
   *  @static
   *  @example
   *      // Using the `oColReorder` option in the DataTables options object
   *      $('#example').dataTable( {
   *          "sDom": 'Rlfrtip',
   *          "oColReorder": {
   *              "bRealtime": true
   *          }
   *      } );
   *
   *  @example
   *      // Using `new` constructor
   *      $('#example').dataTable()
   *
   *      new $.fn.dataTable.ColReorder( '#example', {
   *          "bRealtime": true
   *      } );
   */</span>
  bRealtime: <span class="hljs-literal">false</span>,

  <span class="hljs-comment">/**
   * Indicate how many columns should be fixed in position (counting from the
   * left). This will typically be 1 if used, but can be as high as you like.
   *  @type int
   *  @default 0
   *  @static
   *  @example
   *      // Using the `oColReorder` option in the DataTables options object
   *      $('#example').dataTable( {
   *          "sDom": 'Rlfrtip',
   *          "oColReorder": {
   *              "iFixedColumns": 1
   *          }
   *      } );
   *
   *  @example
   *      // Using `new` constructor
   *      $('#example').dataTable()
   *
   *      new $.fn.dataTable.ColReorder( '#example', {
   *          "iFixedColumns": 1
   *      } );
   */</span>
  iFixedColumns: <span class="hljs-number">0</span>,

  <span class="hljs-comment">/**
   * As `iFixedColumnsRight` but counting from the right.
   *  @type int
   *  @default 0
   *  @static
   *  @example
   *      // Using the `oColReorder` option in the DataTables options object
   *      $('#example').dataTable( {
   *          "sDom": 'Rlfrtip',
   *          "oColReorder": {
   *              "iFixedColumnsRight": 1
   *          }
   *      } );
   *
   *  @example
   *      // Using `new` constructor
   *      $('#example').dataTable()
   *
   *      new $.fn.dataTable.ColReorder( '#example', {
   *          "iFixedColumnsRight": 1
   *      } );
   */</span>
  iFixedColumnsRight: <span class="hljs-number">0</span>,

  <span class="hljs-comment">/**
   * Callback function that is fired when columns are reordered
   *  @type function():void
   *  @default null
   *  @static
   *  @example
   *      // Using the `oColReorder` option in the DataTables options object
   *      $('#example').dataTable( {
   *          "sDom": 'Rlfrtip',
   *          "oColReorder": {
   *              "fnReorderCallback": function () {
   *                  alert( 'Columns reordered' );
   *              }
   *          }
   *      } );
   *
   *  @example
   *      // Using `new` constructor
   *      $('#example').dataTable()
   *
   *      new $.fn.dataTable.ColReorder( '#example', {
   *          "fnReorderCallback": function () {
   *              alert( 'Columns reordered' );
   *          }
   *      } );
   */</span>
  fnReorderCallback: <span class="hljs-literal">null</span>
};



<span class="hljs-comment">/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 * Constants
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */</span>

<span class="hljs-comment">/**
 * ColReorder version
 *  @constant  version
 *  @type      String
 *  @default   As code
 */</span>
ColReorder.version = <span class="hljs-string">"1.1.3-dev"</span>;



<span class="hljs-comment">/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 * DataTables interfaces
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */</span></pre></div></div>
            
        </li>
        
        
        <li id="section-127">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-127">&#182;</a>
              </div>
              <p>Expose</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>$.fn.dataTable.ColReorder = ColReorder;
$.fn.DataTable.ColReorder = ColReorder;</pre></div></div>
            
        </li>
        
        
        <li id="section-128">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-128">&#182;</a>
              </div>
              <p>Register a new feature with DataTables</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> $.fn.dataTable == <span class="hljs-string">"function"</span> &amp;&amp;
     <span class="hljs-keyword">typeof</span> $.fn.dataTableExt.fnVersionCheck == <span class="hljs-string">"function"</span> &amp;&amp;
     $.fn.dataTableExt.fnVersionCheck(<span class="hljs-string">'1.9.3'</span>) )
{
  $.fn.dataTableExt.aoFeatures.push( {
    <span class="hljs-string">"fnInit"</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> settings </span>) </span>{
      <span class="hljs-keyword">var</span> table = settings.oInstance;

      <span class="hljs-keyword">if</span> ( ! settings._colReorder ) {
        <span class="hljs-keyword">var</span> dtInit = settings.oInit;
        <span class="hljs-keyword">var</span> opts = dtInit.colReorder || dtInit.oColReorder || {};

        <span class="hljs-keyword">new</span> ColReorder( settings, opts );
      }
      <span class="hljs-keyword">else</span> {
        table.oApi._fnLog( settings, <span class="hljs-number">1</span>, <span class="hljs-string">"ColReorder attempted to initialise twice. Ignoring second"</span> );
      }

      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">/* No node for DataTables to insert */</span>
    },
    <span class="hljs-string">"cFeature"</span>: <span class="hljs-string">"R"</span>,
    <span class="hljs-string">"sFeature"</span>: <span class="hljs-string">"ColReorder"</span>
  } );
}
<span class="hljs-keyword">else</span> {
  alert( <span class="hljs-string">"Warning: ColReorder requires DataTables 1.9.3 or greater - www.datatables.net/download"</span>);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-129">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-129">&#182;</a>
              </div>
              <p>API augmentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">if</span> ( $.fn.dataTable.Api ) {
  $.fn.dataTable.Api.register( <span class="hljs-string">'colReorder.reset()'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.iterator( <span class="hljs-string">'table'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> ctx </span>) </span>{
      ctx._colReorder.fnReset();
    } );
  } );

  $.fn.dataTable.Api.register( <span class="hljs-string">'colReorder.order()'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> set </span>) </span>{
    <span class="hljs-keyword">if</span> ( set ) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.iterator( <span class="hljs-string">'table'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> ctx </span>) </span>{
        ctx._colReorder.fnOrder( set );
      } );
    }

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.context.length ?
      <span class="hljs-keyword">this</span>.context[<span class="hljs-number">0</span>]._colReorder.fnOrder() :
      <span class="hljs-literal">null</span>;
  } );
}

<span class="hljs-keyword">return</span> ColReorder;
}; <span class="hljs-comment">// /factory</span></pre></div></div>
            
        </li>
        
        
        <li id="section-130">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-130">&#182;</a>
              </div>
              <p>Define as an AMD module if possible</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> define === <span class="hljs-string">'function'</span> &amp;&amp; define.amd ) {
  define( [<span class="hljs-string">'jquery'</span>, <span class="hljs-string">'datatables'</span>], factory );
}
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> exports === <span class="hljs-string">'object'</span> ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-131">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-131">&#182;</a>
              </div>
              <p>Node/CommonJS</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    factory( <span class="hljs-built_in">require</span>(<span class="hljs-string">'jquery'</span>), <span class="hljs-built_in">require</span>(<span class="hljs-string">'datatables'</span>) );
}
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( jQuery &amp;&amp; !jQuery.fn.dataTable.ColReorder ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-132">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-132">&#182;</a>
              </div>
              <p>Otherwise simply initialise as normal, stopping multiple evaluation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  factory( jQuery, jQuery.fn.dataTable );
}


})(<span class="hljs-built_in">window</span>, <span class="hljs-built_in">document</span>);

    app.view.dataTable = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, baseClassName, properties</span>) </span>{
      <span class="hljs-keyword">var</span> baseClass;
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">2</span>) {
        properties = baseClassName;
        baseClass = properties.serverSide ? ServerSideDataTable : LocalDataTable;
      } <span class="hljs-keyword">else</span> {
        baseClass = app.Views[baseClassName];
      }

      app.Views[name] = baseClass.extend(properties);
      baseClass.finalize(name, app.Views[name], app.Views, app.view.dataTable.config, app.name);
    };

    app.view.dataTable.row = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, baseClassName, properties</span>) </span>{
      <span class="hljs-keyword">var</span> baseClass = Row, renderers;
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">2</span>) {
        properties = baseClassName;
      } <span class="hljs-keyword">else</span> {
        baseClass = app.Views[baseClassName];
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-133">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-133">&#182;</a>
              </div>
              <p>special handling for inheritance of renderers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      properties.renderers = _.extend({}, baseClass.prototype.renderers, properties.renderers || {});

      app.Views[name] = baseClass.extend(properties);
      baseClass.finalize(name, app.Views[name], app.Views);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-134">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-134">&#182;</a>
              </div>
              <p>storage for app wide configuration of the plugin</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    app.view.dataTable.config = {
      columnTypes: []
    };

    app.view.dataTable.columnType = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cb</span>) </span>{
      <span class="hljs-keyword">var</span> columnType = <span class="hljs-keyword">new</span> ColumnType();
      cb(columnType);
      app.view.dataTable.config.columnTypes.push(columnType);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-135">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-135">&#182;</a>
              </div>
              <p>add standard column types</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    app.view.dataTable.columnType(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">columnType</span>) </span>{
  columnType.configMatcher(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">config</span>) </span>{
    <span class="hljs-keyword">return</span> config.bulk === <span class="hljs-literal">true</span>;
  });

  columnType.nodeMatcher(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">config</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">".bulk"</span>;
  });

  columnType.definition(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">dataTable, config</span>) </span>{
    <span class="hljs-keyword">return</span> {
      bSortable: config.sort,
      bSearchable: <span class="hljs-literal">false</span>,
      sTitle: <span class="hljs-string">"&lt;input type='checkbox' /&gt;"</span>,
      sClass : <span class="hljs-string">"bulk"</span>,
      mData: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">source, type, val</span>) </span>{
        <span class="hljs-keyword">return</span> dataTable.collection.get(source);
      },
      mRender : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data, type, full</span>) </span>{
        <span class="hljs-keyword">if</span> (type === <span class="hljs-string">"sort"</span> || type === <span class="hljs-string">"type"</span>) {
          <span class="hljs-keyword">return</span> dataTable.selectionManager.has(data) ? <span class="hljs-number">1</span> : -<span class="hljs-number">1</span>;
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
        }
      }
    };
  });

  columnType.renderer(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cell, config</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.checkbox) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">this</span>.checkbox = $(<span class="hljs-string">"&lt;input&gt;"</span>).attr(<span class="hljs-string">"type"</span>, <span class="hljs-string">"checkbox"</span>);
    cell.html(<span class="hljs-keyword">this</span>.checkbox);
  });
});
    app.view.dataTable.columnType(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">columnType</span>) </span>{
  columnType.configMatcher(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">config</span>) </span>{
    <span class="hljs-keyword">return</span> !!config.attr;
  });

  columnType.nodeMatcher(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">config</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">"."</span> + Backdraft.Utils.toCSSClass(config.title);
  });

  columnType.definition(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">dataTable, config</span>) </span>{
    <span class="hljs-keyword">return</span> {
      bSortable: config.sort,
      bSearchable: config.search,
      asSorting: config.sortDir,
      sTitle: config.title,
      sClass : Backdraft.Utils.toCSSClass(config.title),
      mData: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">source, type, val</span>) </span>{
        <span class="hljs-keyword">return</span> dataTable.collection.get(source).get(config.attr);
      },
      mRender : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data, type, full</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-136">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-136">&#182;</a>
              </div>
              <p>note data is based on the result of mData</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (type === <span class="hljs-string">"display"</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-137">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-137">&#182;</a>
              </div>
              <p>nothing to display so that the view can provide its own UI</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> data;
        }
      }
    };
  });

  columnType.renderer(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cell, config</span>) </span>{
    <span class="hljs-keyword">var</span> renderer = <span class="hljs-keyword">this</span>.renderers[config.title];
    <span class="hljs-keyword">if</span> (renderer) {
      renderer.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
    } <span class="hljs-keyword">else</span> {
       cell.text(<span class="hljs-keyword">this</span>.model.get(config.attr));
    }
  });
});

    app.view.dataTable.columnType(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">columnType</span>) </span>{
  columnType.configMatcher(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">config</span>) </span>{
    <span class="hljs-keyword">return</span> !config.attr &amp;&amp; config.title;
  });

  columnType.nodeMatcher(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">config</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">"."</span> + Backdraft.Utils.toCSSClass(config.title);
  });

  columnType.definition(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">dataTable, config</span>) </span>{
    <span class="hljs-keyword">var</span> searchable = !_.isUndefined(config.searchBy), sortable = !_.isUndefined(config.sortBy);
    <span class="hljs-keyword">var</span> ignore = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
    };

    <span class="hljs-keyword">return</span> {
      bSortable: sortable,
      bSearchable: searchable,
      sTitle: config.title,
      sClass : Backdraft.Utils.toCSSClass(config.title),
      mData: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">source, type, val</span>) </span>{
        <span class="hljs-keyword">return</span> dataTable.collection.get(source);
      },
      mRender : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data, type, full</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-138">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-138">&#182;</a>
              </div>
              <p>note data is based on the result of mData</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (type === <span class="hljs-string">"sort"</span>) {
          <span class="hljs-keyword">return</span> (config.sortBy || ignore)(data);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type === <span class="hljs-string">"type"</span>) {
          <span class="hljs-keyword">return</span> (config.sortBy || ignore)(data);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type === <span class="hljs-string">"display"</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-139">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-139">&#182;</a>
              </div>
              <p>renderers will fill content</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">return</span> ignore();
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type === <span class="hljs-string">"filter"</span>) {
          <span class="hljs-keyword">return</span> (config.searchBy || ignore)(data);
        } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-140">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-140">&#182;</a>
              </div>
              <p>note dataTables can call in with undefined type</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">return</span> ignore();
        }
      }
    };
  });

  columnType.renderer(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cell, config</span>) </span>{
    <span class="hljs-keyword">var</span> renderer = <span class="hljs-keyword">this</span>.renderers[config.title];
    <span class="hljs-keyword">if</span> (!renderer) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"renderer is missing for "</span> + <span class="hljs-built_in">JSON</span>.stringify(config));
    renderer.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
  });
});
  });

});


  Backdraft.plugin(<span class="hljs-string">"Listing"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">plugin</span>) </span>{

  <span class="hljs-keyword">var</span> List = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

  <span class="hljs-keyword">var</span> Base = Backdraft.plugin(<span class="hljs-string">"Base"</span>);

  <span class="hljs-keyword">var</span> List = Base.View.extend({

    constructor : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>) </span>{
      <span class="hljs-keyword">this</span>.options = options || {};
      <span class="hljs-keyword">this</span>.cache = <span class="hljs-keyword">new</span> Base.Cache();
      <span class="hljs-keyword">this</span>.itemClass = <span class="hljs-keyword">this</span>.getItemClass();
      List.__super__.constructor.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
      <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.collection) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"A collection must be provided"</span>);
      <span class="hljs-keyword">this</span>.listenTo(<span class="hljs-keyword">this</span>.collection, <span class="hljs-string">"add"</span>, <span class="hljs-keyword">this</span>._onAdd);
      <span class="hljs-keyword">this</span>.listenTo(<span class="hljs-keyword">this</span>.collection, <span class="hljs-string">"remove"</span>, <span class="hljs-keyword">this</span>._onRemove);
      <span class="hljs-keyword">this</span>.listenTo(<span class="hljs-keyword">this</span>.collection, <span class="hljs-string">"reset"</span>, <span class="hljs-keyword">this</span>._onReset);
    },

    _onAdd : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">model</span>) </span>{
      <span class="hljs-keyword">this</span>.$el.append(<span class="hljs-keyword">this</span>._createNewItem(model).render().$el);
    },

    _onRemove : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">model</span>) </span>{
      <span class="hljs-keyword">this</span>.cache.unset(model).close();
    },

    _onReset : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">collection</span>) </span>{
      <span class="hljs-keyword">this</span>.cache.each(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>) </span>{
        item.close();
      }, <span class="hljs-keyword">this</span>);
      <span class="hljs-keyword">this</span>.cache.reset();
      <span class="hljs-keyword">this</span>.$el.empty();</pre></div></div>
            
        </li>
        
        
        <li id="section-141">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-141">&#182;</a>
              </div>
              <p>optimized bulk insertion of views</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> fragment = <span class="hljs-built_in">document</span>.createDocumentFragment();
      <span class="hljs-keyword">this</span>.collection.each(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">model</span>) </span>{
        fragment.appendChild(<span class="hljs-keyword">this</span>._createNewItem(model).render().el);
      }, <span class="hljs-keyword">this</span>);
      <span class="hljs-keyword">this</span>.$el.append(fragment);
    },

    _createNewItem : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">model</span>) </span>{
      <span class="hljs-keyword">var</span> item = <span class="hljs-keyword">new</span> <span class="hljs-keyword">this</span>.itemClass({ model : model });
      <span class="hljs-keyword">this</span>.cache.set(model, item);
      <span class="hljs-keyword">this</span>.child(<span class="hljs-string">"child"</span> + item.cid, item);
      <span class="hljs-keyword">return</span> item;
    },

    render : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>._onReset();
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    }

  }, {

    finalize : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, listClass, views</span>) </span>{
      listClass.prototype.getItemClass = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-142">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-142">&#182;</a>
              </div>
              <p>TODO blow up if can’t find class</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> views[<span class="hljs-keyword">this</span>.itemClassName];
      };
    }

  });

  <span class="hljs-keyword">return</span> List;


})();
  <span class="hljs-keyword">var</span> Item = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

  <span class="hljs-keyword">var</span> Base = Backdraft.plugin(<span class="hljs-string">"Base"</span>);

  <span class="hljs-keyword">var</span> Item = Base.View.extend({

    closeItem : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">this</span>.model.collection.remove(<span class="hljs-keyword">this</span>.model);
    }

  }, {

    finalize : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, listClass, views</span>) </span>{
    }

  });

  <span class="hljs-keyword">return</span> Item;

})();

  plugin.initializer(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">app</span>) </span>{

    app.view.listing = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, properties</span>) </span>{
      app.Views[name] = List.extend(properties);
      List.finalize(name, app.Views[name], app.Views);
    };

    app.view.listing.item = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, properties</span>) </span>{
      app.Views[name] = Item.extend(properties);
      Item.finalize(name, app.Views[name], app.Views);
    }
  });

});

  <span class="hljs-built_in">window</span>.Backdraft = Backdraft;

})(jQuery);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
